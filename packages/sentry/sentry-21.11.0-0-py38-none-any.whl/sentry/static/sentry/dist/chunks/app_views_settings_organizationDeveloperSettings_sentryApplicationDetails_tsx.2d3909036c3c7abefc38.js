(self.webpackChunk=self.webpackChunk||[]).push([["app_views_settings_organizationDeveloperSettings_sentryApplicationDetails_tsx"],{"./app/data/forms/sentryApplication.tsx":(e,t,s)=>{"use strict";s.r(t),s.d(t,{publicIntegrationForms:()=>l,internalIntegrationForms:()=>c});var n=s("./app/components/links/externalLink.tsx"),o=s("./app/locale.tsx"),i=s("./app/utils.tsx"),r=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=()=>[{name:"name",type:"string",required:!0,placeholder:"e.g. My Integration",label:"Name",help:"Human readable name of your Integration."},{name:"author",type:"string",required:!0,placeholder:"e.g. Acme Software",label:"Author",help:"The company or person who built and maintains this Integration."},{name:"webhookUrl",type:"string",required:!0,label:"Webhook URL",placeholder:"e.g. https://example.com/sentry/webhook/",help:(0,o._N)("All webhook requests for your integration will be sent to this URL. Visit the [webhook_docs:documentation] to see the different types and payloads.",{webhook_docs:(0,r.tZ)(n.Z,{href:"https://docs.sentry.io/product/integrations/integration-platform/webhooks/"})})},{name:"redirectUrl",type:"string",label:"Redirect URL",placeholder:"e.g. https://example.com/sentry/setup/",help:"The URL Sentry will redirect users to after installation."},{name:"verifyInstall",label:"Verify Installation",type:"boolean",help:"If enabled, installations will need to be verified before becoming installed."},{name:"isAlertable",type:"boolean",label:"Alert Rule Action",disabled:({webhookDisabled:e})=>e,disabledReason:"Cannot enable alert rule action without a webhook url",help:(0,o._N)("If enabled, this integration will be available in Issue Alert rules and Metric Alert rules in Sentry. The notification destination is the Webhook URL specified above. More on actions [learn_more:here].",{learn_more:(0,r.tZ)(n.Z,{href:"https://docs.sentry.io/product/alerts-notifications/notifications/"})})},{name:"schema",type:"textarea",label:"Schema",autosize:!0,rows:1,help:(0,o._N)("Schema for your UI components. Click [schema_docs:here] for documentation.",{schema_docs:(0,r.tZ)(n.Z,{href:"https://docs.sentry.io/product/integrations/integration-platform/ui-components/"})}),getValue:e=>""===e?{}:JSON.parse(e),setValue:e=>{const t=JSON.stringify(e,null,2);return"{}"===t?"":t},validate:({id:e,form:t})=>{if(!t.schema)return[];try{JSON.parse(t.schema)}catch(t){return[[e,"Invalid JSON"]]}return[]}},{name:"overview",type:"textarea",label:"Overview",autosize:!0,rows:1,help:"Description of your Integration and its functionality."},{name:"allowedOrigins",type:"string",multiline:!0,placeholder:"e.g. example.com",label:"Authorized JavaScript Origins",help:"Separate multiple entries with a newline.",getValue:e=>(0,i.Fl)(e),setValue:e=>e&&"function"==typeof e.join&&e.join("\n")||""}],l=[{title:"Public Integration Details",fields:a()}],c=[{title:"Internal Integration Details",fields:(()=>{const e=a().filter((e=>!["redirectUrl","verifyInstall","author"].includes(e.name||""))),t=e.find((e=>"webhookUrl"===e.name));return t&&(t.required=!1),e})()}]},"./app/utils/consolidatedScopes.tsx":(e,t,s)=>{"use strict";s.d(t,{A:()=>f,m:()=>b}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=s("../node_modules/lodash/groupBy.js"),o=s.n(n),i=s("../node_modules/lodash/invertBy.js"),r=s.n(i),a=s("../node_modules/lodash/pick.js"),l=s.n(a);const c={read:0,write:1,admin:2},d={project:"Project",team:"Team",release:"Release",event:"Event",org:"Organization",member:"Member"},p={Project:"no-access",Team:"no-access",Release:"no-access",Event:"no-access",Organization:"no-access",Member:"no-access"},h="project:releases",u=e=>{const t=e.split(":")[1];return c[t]},m=(e,t)=>u(e)-u(t);function b(e){const t={...p};let s=[...e];var n;return e.includes(h)&&(t.Release="admin",s=e.filter((e=>e!==h))),(n=s,Object.values(o()(n,(e=>e.split(":")[0]))).map((e=>e.sort(m))).map((e=>e.pop()))).forEach((e=>{if(e){const[s,n]=e.split(":");t[d[s]]=n}})),t}function f(e){const t=b(e);return{read:[],write:[],admin:[],...l()(r()(t),["read","write","admin"])}}},"./app/utils/routeTitle.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=function(e,t,s=!0,n){const o="".concat(e," - ").concat(t),i=n?"".concat(o," - ").concat(n):o;return s?"".concat(i," - Sentry"):i}},"./app/views/asyncView.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>a}),s("../node_modules/react/index.js");var n=s("../node_modules/react-document-title/index.js"),o=s.n(n),i=s("./app/components/asyncComponent.tsx"),r=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class a extends i.Z{getTitle(){return""}render(){const e=this.getTitle();return(0,r.tZ)(o(),{title:"".concat(e?"".concat(e," - "):"","Sentry"),children:this.renderComponent()})}}a.displayName="AsyncView"},"./app/views/settings/organizationDeveloperSettings/sentryApplicationDetails.tsx":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>se});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/web.url.to-json.js"),s("../node_modules/react/index.js")),r=s("../node_modules/react-router/es/index.js"),a=s("../node_modules/lodash/omit.js"),l=s.n(a),c=s("../node_modules/mobx-react-lite/es/index.js"),d=s("../node_modules/scroll-to-element/index.js"),p=s.n(d),h=s("./app/actionCreators/indicator.tsx"),u=s("./app/locale.tsx"),m=s("./app/components/button.tsx"),b=s("./app/components/dateTime.tsx"),f=s("./app/components/panels/index.tsx"),g=s("./app/components/tooltip.tsx"),v=s("./app/constants/index.tsx"),y=s("./app/data/forms/sentryApplication.tsx"),x=s("./app/icons/index.tsx"),w=s("./app/utils/getDynamicText.tsx"),Z=s("./app/utils/routeTitle.tsx"),k=s("./app/views/asyncView.tsx"),_=s("./app/views/settings/components/emptyMessage.tsx"),S=s("./app/views/settings/components/forms/form.tsx"),j=s("./app/views/settings/components/forms/formField/index.tsx"),I=s("./app/views/settings/components/forms/jsonForm.tsx"),C=s("./app/views/settings/components/forms/model.tsx"),T=s("./app/views/settings/components/forms/textCopyInput.tsx"),D=s("./app/views/settings/components/settingsPageHeader.tsx"),P=s("./app/utils/consolidatedScopes.tsx"),E=s("../node_modules/lodash/find.js"),N=s.n(E),O=s("../node_modules/lodash/flatMap.js"),z=s.n(O),A=s("./app/views/settings/components/forms/formContext.tsx"),F=s("./app/views/settings/components/forms/selectField.tsx"),B=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class R extends i.Component{constructor(...e){super(...e),(0,n.Z)(this,"state",{permissions:this.props.permissions}),(0,n.Z)(this,"onChange",((e,t)=>{const{permissions:s}=this.state;s[e]=t,this.save(s)})),(0,n.Z)(this,"save",(e=>{this.setState({permissions:e}),this.props.onChange(e),this.context.form.setValue("scopes",this.permissionStateToList())}))}permissionStateToList(){const{permissions:e}=this.state;return z()(Object.entries(e),(([e,t])=>{var s,n,o;return null===(s=(e=>N()(v.yh,["resource",e]))(e))||void 0===s||null===(n=s.choices)||void 0===n||null===(o=n[t])||void 0===o?void 0:o.scopes}))}render(){const{permissions:e}=this.state;return(0,B.tZ)(i.Fragment,{children:v.yh.map((t=>{const s=Object.entries(t.choices).map((([e,{label:t}])=>({value:e,label:t}))),n=e[t.resource];return(0,B.tZ)(F.Z,{name:"".concat(t.resource,"--permission"),options:s,help:(0,u.t)(t.help),label:(0,u.t)(t.label||t.resource),onChange:this.onChange.bind(this,t.resource),value:n,defaultValue:n,disabled:this.props.appPublished,disabledReason:(0,u.t)("Cannot update permissions on a published integration")},t.resource)}))})}}R.displayName="PermissionSelection",(0,n.Z)(R,"contextType",A.Z);const U=["issue","error"],V={issue:"created, resolved, assigned",error:"created"},L={issue:"Event",error:"Event"};var X=s("./app/components/checkbox.tsx"),M=s("./app/utils/withOrganization.tsx");class J extends i.Component{constructor(...e){super(...e),(0,n.Z)(this,"onChange",(e=>{const t=e.target.checked,{resource:s}=this.props;this.props.onChange(s,t)}))}render(){const{resource:e,organization:t,webhookDisabled:s,checked:n}=this.props,o=new Set(t.features);let r=this.props.disabledFromPermissions||s,a="Must have at least 'Read' permissions enabled for ".concat(e);return"error"!==e||o.has("integrations-event-hooks")||(r=!0,a="Your organization does not have access to the error subscription resource."),s&&(a="Cannot enable webhook subscription without specifying a webhook url"),(0,B.tZ)(i.Fragment,{children:(0,B.tZ)(Y,{children:(0,B.tZ)(g.Z,{disabled:!r,title:a,children:(0,B.BX)(H,{disabled:r,children:[(0,B.BX)(W,{children:[(0,B.tZ)(G,{children:(0,u.t)("".concat(e))}),(0,B.tZ)(Q,{children:(0,u.t)("".concat(V[e]))})]}),(0,B.tZ)(X.Z,{disabled:r,id:e,value:e,checked:n,onChange:this.onChange},"".concat(e).concat(n))]})})},e)})}}J.displayName="SubscriptionBox",(0,n.Z)(J,"defaultProps",{webhookDisabled:!1});const q=(0,M.Z)(J),W=(0,o.Z)("div",{target:"eosxblu4"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),H=(0,o.Z)("div",{target:"eosxblu3"})("display:flex;flex-direction:row;justify-content:space-between;background:",(e=>e.theme.backgroundSecondary),";opacity:",(({disabled:e})=>e?.3:1),";border-radius:3px;flex:1;padding:12px;height:100%;"),Y=(0,o.Z)("div",{target:"eosxblu2"})({name:"wztxm7",styles:"padding:12px;width:33%"}),Q=(0,o.Z)("div",{target:"eosxblu1"})("font-size:12px;line-height:1;color:",(e=>e.theme.gray300),";white-space:nowrap;"),G=(0,o.Z)("div",{target:"eosxblu0"})("font-size:16px;line-height:1;color:",(e=>e.theme.textColor),";white-space:nowrap;margin-bottom:5px;");class K extends i.Component{constructor(e,t){super(e,t),(0,n.Z)(this,"onChange",((e,t)=>{const s=new Set(this.props.events);t?s.add(e):s.delete(e),this.save(Array.from(s))})),(0,n.Z)(this,"save",(e=>{this.props.onChange(e),this.context.form.setValue("events",e)})),this.context.form.setValue("events",this.props.events)}UNSAFE_componentWillReceiveProps(e){e.webhookDisabled&&this.props.events.length&&this.save([])}componentDidUpdate(){const{permissions:e,events:t}=this.props,s=t.filter((t=>"no-access"!==e[L[t]]));JSON.stringify(t)!==JSON.stringify(s)&&this.save(s)}render(){const{permissions:e,webhookDisabled:t,events:s}=this.props;return(0,B.tZ)($,{children:U.map((n=>{const o="no-access"===e[L[n]];return(0,B.tZ)(i.Fragment,{children:(0,B.tZ)(q,{disabledFromPermissions:o,webhookDisabled:t,checked:s.includes(n)&&!o,resource:n,onChange:this.onChange},n)},n)}))})}}K.displayName="Subscriptions",(0,n.Z)(K,"defaultProps",{webhookDisabled:!1}),(0,n.Z)(K,"contextType",A.Z);const $=(0,o.Z)("div",{target:"e3puty70"})({name:"5kov97",styles:"display:flex;flex-wrap:wrap"});class ee extends i.Component{constructor(e){super(e),(0,n.Z)(this,"onPermissionChange",(e=>{this.setState({permissions:e})})),(0,n.Z)(this,"onEventChange",(e=>{this.setState({events:e})})),this.state={permissions:this.scopeListToPermissionState(),events:this.props.events}}scopeListToPermissionState(){return(0,P.m)(this.props.scopes)}render(){const{permissions:e,events:t}=this.state;return(0,B.BX)(i.Fragment,{children:[(0,B.BX)(f.s_,{children:[(0,B.tZ)(f.V9,{children:(0,u.t)("Permissions")}),(0,B.tZ)(f.N,{children:(0,B.tZ)(R,{permissions:e,onChange:this.onPermissionChange,appPublished:this.props.appPublished})})]}),(0,B.BX)(f.s_,{children:[(0,B.tZ)(f.V9,{children:(0,u.t)("Webhooks")}),(0,B.tZ)(f.N,{children:(0,B.tZ)(K,{permissions:e,events:t,onChange:this.onEventChange,webhookDisabled:this.props.webhookDisabled})})]})]})}}ee.displayName="PermissionsObserver",(0,n.Z)(ee,"defaultProps",{webhookDisabled:!1,appPublished:!1});class te extends C.Z{getData(){return this.fields.toJSON().reduce(((e,[t,s])=>(t.endsWith("--permission")||(e[t]=s),e)),{})}mapFormErrors(e){if(!e)return e;const t=l()(e,["scopes"]);return e.scopes&&e.scopes.forEach((e=>{const s=e.match(/Requested permission of (\w+:\w+)/);if(s){const n=(e=>{for(const t of v.yh)if(Object.values(t.choices).reduce(((e,t)=>{var s;return e.concat(null!==(s=null==t?void 0:t.scopes)&&void 0!==s?s:[])}),[]).includes(e))return t.resource})(s[1]);n&&(t["".concat(n,"--permission")]=[e])}})),t}}class se extends k.Z{constructor(...e){super(...e),(0,n.Z)(this,"form",new te),(0,n.Z)(this,"handleSubmitSuccess",(e=>{const{app:t}=this.state,{orgId:s}=this.props.params,n="/settings/".concat(s,"/developer-settings/"),o=t?n:"".concat(n).concat(e.slug,"/");t?(0,h.S9)((0,u.t)("%s successfully saved.",e.name)):(0,h.S9)((0,u.t)("%s successfully created.",e.name)),r.browserHistory.push(o)})),(0,n.Z)(this,"handleSubmitError",(e=>{let t=(0,u.t)("Unknown Error");var s;if(e.status>=400&&e.status<500&&(t=null!==(s=null==e?void 0:e.responseJSON.detail)&&void 0!==s?s:t),(0,h.Iw)(t),this.form.formErrors){const e=Object.keys(this.form.formErrors)[0];e&&p()("#".concat(e),{align:"middle",offset:0})}})),(0,n.Z)(this,"onAddToken",(async e=>{e.preventDefault();const{app:t,tokens:s}=this.state;if(!t)return;const n=this.api,o=await async function(e,t){(0,h.E3)();try{const s=await e.requestPromise("/sentry-apps/".concat(t.slug,"/api-tokens/"),{method:"POST"});return(0,h.S9)((0,u.t)("Token successfully added.")),s}catch(e){throw(0,h.Iw)((0,u.t)("Unable to create token")),e}}(n,t),i=s.concat(o);this.setState({tokens:i})})),(0,n.Z)(this,"onRemoveToken",(async(e,t)=>{t.preventDefault();const{app:s,tokens:n}=this.state;if(!s)return;const o=this.api,i=n.filter((t=>t.token!==e.token));await async function(e,t,s){(0,h.E3)();try{return await e.requestPromise("/sentry-apps/".concat(t.slug,"/api-tokens/").concat(s,"/"),{method:"DELETE"}),void(0,h.S9)((0,u.t)("Token successfully deleted."))}catch(e){throw(0,h.Iw)((0,u.t)("Unable to delete token")),e}}(o,s,e.token),this.setState({tokens:i})})),(0,n.Z)(this,"renderTokens",(()=>{const{tokens:e}=this.state;return e.length>0?e.map((e=>(0,B.BX)(ne,{children:[(0,B.tZ)(oe,{children:(0,B.tZ)(g.Z,{disabled:this.showAuthInfo,position:"right",containerDisplayMode:"inline",title:(0,u.t)("You do not have access to view these credentials because the permissions for this integration exceed those of your role."),children:(0,B.tZ)(T.Z,{children:(0,w.Z)({value:e.token,fixed:"xxxxxx"})})})}),(0,B.BX)(re,{children:[(0,B.tZ)(ie,{children:"Created:"}),(0,B.tZ)(b.Z,{date:(0,w.Z)({value:e.dateCreated,fixed:new Date(150820808e4)})})]}),(0,B.tZ)(m.ZP,{onClick:this.onRemoveToken.bind(this,e),size:"small",icon:(0,B.tZ)(x.Fz,{}),"data-test-id":"token-delete",type:"button",children:(0,u.t)("Revoke")})]},e.token))):(0,B.tZ)(_.Z,{description:(0,u.t)("No tokens created yet.")})})),(0,n.Z)(this,"onFieldChange",((e,t)=>{"webhookUrl"===e&&!t&&this.isInternal&&this.form.setValue("isAlertable",!1)}))}getDefaultState(){return{...super.getDefaultState(),app:null,tokens:[]}}getEndpoints(){const{appSlug:e}=this.props.params;return e?[["app","/sentry-apps/".concat(e,"/")],["tokens","/sentry-apps/".concat(e,"/api-tokens/")]]:[]}getTitle(){const{orgId:e}=this.props.params;return(0,Z.Z)((0,u.t)("Sentry Integration Details"),e,!1)}normalize(e){return 0===e.length?e:e.map((e=>e.split(".").shift()))}get isInternal(){const{app:e}=this.state;return e?"internal"===e.status:"new-internal/"===this.props.route.path}get showAuthInfo(){const{app:e}=this.state;return!(e&&e.clientSecret&&"*"===e.clientSecret[0])}renderBody(){const{orgId:e}=this.props.params,{app:t}=this.state,s=t&&[...t.scopes]||[],n=t&&this.normalize(t.events)||[],o=t?"PUT":"POST",r=t?"/sentry-apps/".concat(t.slug,"/"):"/sentry-apps/",a=this.isInternal?y.internalIntegrationForms:y.publicIntegrationForms;let l;return l=!this.isInternal&&(!t||t.verifyInstall),(0,B.BX)("div",{children:[(0,B.tZ)(D.Z,{title:this.getTitle()}),(0,B.BX)(S.Z,{apiMethod:o,apiEndpoint:r,allowUndo:!0,initialData:{organization:e,isAlertable:!1,isInternal:this.isInternal,schema:{},scopes:[],...t,verifyInstall:l},model:this.form,onSubmitSuccess:this.handleSubmitSuccess,onSubmitError:this.handleSubmitError,onFieldChange:this.onFieldChange,children:[(0,B.tZ)(c.Qj,{children:()=>{const e=this.isInternal&&!this.form.getValue("webhookUrl");return(0,B.BX)(i.Fragment,{children:[(0,B.tZ)(I.Z,{additionalFieldProps:{webhookDisabled:e},forms:a}),(0,B.tZ)(ee,{webhookDisabled:e,appPublished:!!t&&"published"===t.status,scopes:s,events:n})]})}}),t&&"internal"===t.status&&(0,B.BX)(f.s_,{children:[(0,B.BX)(f.V9,{hasButtons:!0,children:[(0,u.t)("Tokens"),(0,B.tZ)(m.ZP,{size:"xsmall",icon:(0,B.tZ)(x.N_,{size:"xs",isCircled:!0}),onClick:e=>this.onAddToken(e),"data-test-id":"token-add",type:"button",children:(0,u.t)("New Token")})]}),(0,B.tZ)(f.N,{children:this.renderTokens()})]}),t&&(0,B.BX)(f.s_,{children:[(0,B.tZ)(f.V9,{children:(0,u.t)("Credentials")}),(0,B.BX)(f.N,{children:["internal"!==t.status&&(0,B.tZ)(j.Z,{name:"clientId",label:"Client ID",children:({value:e})=>(0,B.tZ)(T.Z,{children:(0,w.Z)({value:e,fixed:"CI_CLIENT_ID"})})}),(0,B.tZ)(j.Z,{name:"clientSecret",label:"Client Secret",children:({value:e})=>e?(0,B.tZ)(g.Z,{disabled:this.showAuthInfo,position:"right",containerDisplayMode:"inline",title:(0,u.t)("You do not have access to view these credentials because the permissions for this integration exceed those of your role."),children:(0,B.tZ)(T.Z,{children:(0,w.Z)({value:e,fixed:"CI_CLIENT_SECRET"})})}):(0,B.tZ)("em",{children:"hidden"})})]})]})]})]})}}const ne=(0,o.Z)(f.Lv,{target:"e1yio6dz3"})({name:"1eoy87d",styles:"display:flex;justify-content:space-between"}),oe=(0,o.Z)("div",{target:"e1yio6dz2"})({name:"maimdf",styles:"width:70%"}),ie=(0,o.Z)("span",{target:"e1yio6dz1"})("color:",(e=>e.theme.gray300),";margin-bottom:2px;"),re=(0,o.Z)("div",{target:"e1yio6dz0"})({name:"mdywmg",styles:"display:flex;flex-direction:column;font-size:14px;margin:0 10px"})},"../node_modules/lodash/_baseInverter.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseForOwn.js");e.exports=function(e,t,s,o){return n(e,(function(e,n,i){t(o,s(e),n,i)})),o}},"../node_modules/lodash/_createFind.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseIteratee.js"),o=s("../node_modules/lodash/isArrayLike.js"),i=s("../node_modules/lodash/keys.js");e.exports=function(e){return function(t,s,r){var a=Object(t);if(!o(t)){var l=n(s,3);t=i(t),s=function(e){return l(a[e],e,a)}}var c=e(t,s,r);return c>-1?a[l?t[c]:c]:void 0}}},"../node_modules/lodash/_createInverter.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseInverter.js");e.exports=function(e,t){return function(s,o){return n(s,e,t(o),{})}}},"../node_modules/lodash/find.js":(e,t,s)=>{var n=s("../node_modules/lodash/_createFind.js")(s("../node_modules/lodash/findIndex.js"));e.exports=n},"../node_modules/lodash/invertBy.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseIteratee.js"),o=s("../node_modules/lodash/_createInverter.js"),i=Object.prototype,r=i.hasOwnProperty,a=i.toString,l=o((function(e,t,s){null!=t&&"function"!=typeof t.toString&&(t=a.call(t)),r.call(e,t)?e[t].push(s):e[t]=[s]}),n);e.exports=l}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationDeveloperSettings_sentryApplicationDetails_tsx.8d0de291f7cecfb88fc9f0a750dc0f95.js.map