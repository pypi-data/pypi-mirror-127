"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_dashboardsV2_widgetCard_tsx"],{"./app/actionCreators/events.tsx":(e,t,s)=>{s.d(t,{lI:()=>d,eV:()=>l,JE:()=>p}),s("../node_modules/core-js/modules/es.object.from-entries.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/lodash/pick.js"),r=s.n(o),n=s("./app/components/charts/utils.tsx"),i=s("./app/utils/getPeriod.tsx"),a=s("./app/utils/performance/constants.tsx");const d=(e,{organization:t,project:s,environment:o,team:r,period:a,start:d,end:l,interval:p,comparisonDelta:c,includePrevious:u,query:h,yAxis:m,field:g,topEvents:y,orderby:v,partial:b,withoutZerofill:x,referrer:Z})=>{const f=(0,n.Sw)(u,a),w=Object.fromEntries(Object.entries({interval:p,comparisonDelta:c,project:s,environment:o,team:r,query:h,yAxis:m,field:g,topEvents:y,orderby:v,partial:b?"1":void 0,withoutZerofill:x?"1":void 0,referrer:Z||"api.organization-event-stats"}).filter((([,e])=>void 0!==e))),C=(0,i.X)({period:a,start:d,end:l},{shouldDoublePeriod:f});return e.requestPromise("/organizations/".concat(t.slug,"/events-stats/"),{query:{...w,...C}})};async function l(e,t,s){const o={...r()(s,Object.values(a.s)),query:s.query};return e.requestPromise("/organizations/".concat(t,"/events-facets/"),{query:o})}async function p(e,t,s){const o={...r()(s,Object.values(a.s)),query:s.query};return e.requestPromise("/organizations/".concat(t,"/events-meta/"),{query:o}).then((e=>e.count))}},"./app/components/charts/areaChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var o=s("../node_modules/react/index.js"),r=s("./app/components/charts/series/lineSeries.tsx"),n=s("./app/components/charts/baseChart.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class a extends o.Component{render(){const{series:e,stacked:t,colors:s,...o}=this.props;return(0,i.tZ)(n.Z,{...o,colors:s,series:e.map((({seriesName:e,data:o,...n},i)=>function(e={}){return(0,r.Z)({...e})}({stack:t?"area":void 0,name:e,data:o.map((({name:e,value:t})=>[e,t])),lineStyle:{color:null==s?void 0:s[i],opacity:1,width:.4},areaStyle:{color:null==s?void 0:s[i],opacity:1},animation:!1,animationThreshold:1,animationDuration:0,...n})))})}}a.displayName="AreaChart";const d=a},"./app/components/charts/chartZoom.tsx":(e,t,s)=>{s.d(t,{Z:()=>g});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/react/index.js"),n=s("../node_modules/moment/moment.js"),i=s.n(n),a=s("../node_modules/query-string/index.js"),d=s("./app/actionCreators/globalSelection.tsx"),l=s("./app/components/charts/components/dataZoomInside.tsx"),p=s("./app/components/charts/components/toolBox.tsx"),c=s("./app/utils/callIfFunction.tsx"),u=s("./app/utils/dates.tsx");const h=e=>e?i().utc(e).format(i().HTML5_FMT.DATETIME_LOCAL_SECONDS):null;class m extends r.Component{constructor(e){super(e),(0,o.Z)(this,"history",void 0),(0,o.Z)(this,"currentPeriod",void 0),(0,o.Z)(this,"zooming",null),(0,o.Z)(this,"saveCurrentPeriod",(e=>{this.currentPeriod={period:e.period,start:h(e.start),end:h(e.end)}})),(0,o.Z)(this,"setPeriod",(({period:e,start:t,end:s},o=!1)=>{const{router:r,onZoom:n,usePageDate:i}=this.props,l=h(t),p=h(s);o&&this.history.push(this.currentPeriod),(0,c.g)(n,{period:e,start:l,end:p}),this.zooming=()=>{if(i&&r){const o={...r.location.query,pageStart:t?(0,u.v5)(t):void 0,pageEnd:s?(0,u.v5)(s):void 0,pageStatsPeriod:null!=e?e:void 0};a.stringify(o)!==a.stringify(r.location.query)&&r.push({pathname:r.location.pathname,query:o})}else(0,d.dR)({period:e,start:l?(0,u.hC)(l):l,end:p?(0,u.hC)(p):p},r);this.saveCurrentPeriod({period:e,start:t,end:s})}})),(0,o.Z)(this,"handleChartReady",(e=>{e.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),(0,c.g)(this.props.onChartReady,e)})),(0,o.Z)(this,"handleZoomRestore",((e,t)=>{this.history.length&&(this.setPeriod(this.history[0]),this.history=[],(0,c.g)(this.props.onRestore,e,t))})),(0,o.Z)(this,"handleDataZoom",((e,t)=>{const s=t.getModel(),{xAxis:o}=s.option,r=o[0];if(null===r.rangeStart&&null===r.rangeEnd){const e=this.history.pop();if(!e)return;this.setPeriod(e)}else{const e=i().utc(r.rangeStart),t=i().utc(r.rangeEnd);this.setPeriod({period:null,start:e,end:t},!0)}(0,c.g)(this.props.onDataZoom,e,t)})),(0,o.Z)(this,"handleChartFinished",(()=>{"function"==typeof this.zooming&&(this.zooming(),this.zooming=null),(0,c.g)(this.props.onFinished)})),this.history=[],this.saveCurrentPeriod(e)}componentDidUpdate(){this.props.disabled||this.saveCurrentPeriod(this.props)}render(){const{utc:e,start:t,end:s,disabled:o,children:r,xAxisIndex:n,router:i,onZoom:a,onRestore:d,onChartReady:c,onDataZoom:h,onFinished:m,...g}=this.props,y=null!=e?e:void 0,v=t?(0,u.hC)(t):void 0,b=s?(0,u.hC)(s):void 0;return r(o?{utc:y,start:v,end:b,...g}:{isGroupedByDate:!0,onChartReady:this.handleChartReady,utc:y,start:v,end:b,dataZoom:(0,l.Z)({xAxisIndex:n}),showTimeInTooltip:!0,toolBox:(0,p.Z)({},{dataZoom:{title:{zoom:"",back:""},iconStyle:{borderWidth:0,color:"transparent",opacity:0}}}),onDataZoom:this.handleDataZoom,onFinished:this.handleChartFinished,onRestore:this.handleZoomRestore,...g})}}m.displayName="ChartZoom";const g=m},"./app/components/charts/components/visualMap.tsx":(e,t,s)=>{function o(e){return e}s.d(t,{Z:()=>o}),s("../node_modules/echarts/lib/component/visualMap.js")},"./app/components/charts/lineChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>a});var o=s("../node_modules/react/index.js"),r=s("./app/components/charts/series/lineSeries.tsx"),n=s("./app/components/charts/baseChart.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class a extends o.Component{render(){const{series:e,seriesOptions:t,...s}=this.props;return(0,i.tZ)(n.Z,{...s,series:e.map((({seriesName:e,data:s,dataArray:o,...n})=>(0,r.Z)({...t,...n,name:e,data:o||(null==s?void 0:s.map((({value:e,name:t})=>[t,e]))),animation:!1,animationThreshold:1,animationDuration:0})))})}}a.displayName="LineChart"},"./app/components/charts/transitionChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("./app/components/charts/loadingPanel.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class a extends r.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{prevReloading:this.props.reloading,prevLoading:this.props.loading,key:1})}static getDerivedStateFromProps(e,t){const s=t.prevReloading,o=e.reloading,r=t.prevLoading,n=e.loading;return r!==n?{prevReloading:o,prevLoading:n,key:t.key+1}:n?{prevReloading:o,prevLoading:n,key:t.key}:s&&!o?{prevReloading:o,prevLoading:n,key:t.key+1}:{prevReloading:o,prevLoading:n,key:t.key}}render(){const{height:e,loading:t,reloading:s}=this.props;return t&&!s?(0,i.tZ)(n.Z,{height:e,"data-test-id":"events-request-loading"}):(0,i.tZ)(r.Fragment,{children:this.props.children},String(this.state.key))}}a.displayName="TransitionChart",(0,o.Z)(a,"defaultProps",{height:"200px"});const d=a},"./app/components/charts/transparentLoadingMask.tsx":(e,t,s)=>{s.d(t,{Z:()=>i});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/react/index.js"),s("./app/components/loadingMask.tsx")),n=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,o.Z)((({className:e,visible:t,children:s,...o})=>{const i=t?{...o,"data-test-id":"loading-placeholder"}:o;return(0,n.tZ)(r.Z,{className:e,...i,children:s})}),{target:"ewtkxp50"})((e=>!e.visible&&"display: none;"),";opacity:0.4;z-index:1;")},"./app/components/charts/worldMapChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>m});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.object.from-entries.js"),s("../node_modules/react/index.js")),n=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),i=s("../node_modules/echarts/index.js"),a=s.n(i),d=s("../node_modules/lodash/max.js"),l=s.n(d),p=s("./app/components/charts/components/visualMap.tsx");s("../node_modules/echarts/lib/chart/map.js");var c=s("./app/components/charts/baseChart.tsx"),u=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h extends r.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{countryToCodeMap:null,map:null,codeToCountryMap:null})}async componentDidMount(){const[e,t]=await Promise.all([s.e("app_data_countryCodesMap_tsx").then(s.bind(s,"./app/data/countryCodesMap.tsx")),s.e("app_data_world_json").then(s.t.bind(s,"./app/data/world.json",19))]);a().registerMap("sentryWorld",t.default),this.setState({countryToCodeMap:e.default,map:t.default,codeToCountryMap:Object.fromEntries(Object.entries(e.default).map((([e,t])=>[t,e])))})}render(){const{countryToCodeMap:e,map:t}=this.state;if(null===e||null===t)return null;const{series:s,seriesOptions:o,theme:r,fromDiscover:n,fromDiscoverQueryList:i,...a}=this.props,d=s.map((({seriesName:e,data:t,...s})=>{var a;return function(e={}){return{roam:!0,itemStyle:{emphasis:{label:{show:!1}}},...e,type:"map"}}({...o,...s,map:"sentryWorld",name:e,nameMap:null!==(a=this.state.countryToCodeMap)&&void 0!==a?a:void 0,aspectScale:.85,zoom:n?1.1:i?.9:1.3,center:[10.97,i?-12:9.71],itemStyle:{areaColor:r.gray200,borderColor:r.backgroundSecondary,emphasis:{areaColor:r.pink300}},label:{emphasis:{show:!1}},data:t,silent:i,roam:!i})})),h=l()(s.map((({data:e})=>l()(e.map((({value:e})=>e))))))||1;return(0,u.tZ)(c.Z,{options:{backgroundColor:i?void 0:r.background,visualMap:[(0,p.Z)({show:!i,left:n?void 0:"right",right:n?5:void 0,min:0,max:h,inRange:{color:[r.purple200,r.purple300]},text:["High","Low"],textStyle:{color:r.textColor},calculable:!1})]},...a,yAxis:null,xAxis:null,series:d,tooltip:{formatter:e=>{var t;const{marker:s,name:o,value:r}=Array.isArray(e)?e[0]:e;if(isNaN(r))return"";const n="number"==typeof r?r.toLocaleString():"",i=(null===(t=this.state.codeToCountryMap)||void 0===t?void 0:t[o])||o;return['<div class="tooltip-series tooltip-series-solo">\n                 <div><span class="tooltip-label">'.concat(s," <strong>").concat(i,"</strong></span> ").concat(n,"</div>\n              </div>"),'<div class="tooltip-arrow"></div>'].join("")}},height:n?400:void 0})}}h.displayName="WorldMapChart";const m=(0,n.b)(h)},"./app/utils/discover/charts.tsx":(e,t,s)=>{s.d(t,{CX:()=>i,gu:()=>a});var o=s("./app/locale.tsx"),r=s("./app/utils/discover/fields.tsx"),n=s("./app/utils/formatters.tsx");function i(e,t=""){switch((0,r.Px)(t)){case"integer":case"number":return e.toLocaleString();case"percentage":return(0,n.rl)(e,2);case"duration":return(0,n.g9)(e/1e3,2,!0);default:return e.toString()}}function a(e,t,s=!1){switch((0,r.Px)(t)){case"integer":case"number":return s?(0,n.Du)(e):e.toLocaleString();case"percentage":return(0,n.rl)(e,0);case"duration":return function(e){if(0===e)return"0";if(e>=n.ps){const t=(e/n.ps).toFixed(0);return(0,o.t)("%swk",t)}if(e>=n.x4){const t=(e/n.x4).toFixed(0);return(0,o.t)("%sd",t)}if(e>=n.kr){const t=(e/n.kr).toFixed(0);return(0,o.t)("%shr",t)}if(e>=n.EB){const t=(e/n.EB).toFixed(0);return(0,o.t)("%smin",t)}if(e>=n.sh){const t=(e/n.sh).toFixed(0);return(0,o.t)("%ss",t)}const t=e.toFixed(0);return(0,o.t)("%sms",t)}(e);default:return e.toString()}}},"./app/utils/getPeriod.tsx":(e,t,s)=>{s.d(t,{X:()=>a}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/moment/moment.js"),r=s.n(o),n=s("./app/constants/index.tsx"),i=s("./app/utils/dates.tsx");const a=({period:e,start:t,end:s},{shouldDoublePeriod:o}={})=>{if(e||t||s||(e=n.GY),e){if(!o)return{statsPeriod:e};const[,t,s]=e.match(/([0-9]+)([mhdw])/);return{statsPeriod:"".concat(2*parseInt(t,10)).concat(s)}}if(!t||!s)throw new Error("start and end required");const a=(0,i.v5)(t),d=(0,i.v5)(s);if(o){const e=r()(s).diff(r()(t)),o=r()(t).subtract(e);return{start:(0,i.v5)(o),end:d}}return{start:a,end:d}}},"./app/views/dashboardsV2/widget/utils.tsx":(e,t,s)=>{s.d(t,{FO:()=>r,qg:()=>n,hV:()=>i});var o=s("./app/locale.tsx");let r,n;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area",e.TOP_N="top_n"}(r||(r={})),function(e){e.EVENTS="events",e.METRICS="metrics"}(n||(n={}));const i={[r.AREA]:(0,o.t)("Area Chart"),[r.BAR]:(0,o.t)("Bar Chart"),[r.LINE]:(0,o.t)("Line Chart"),[r.TABLE]:(0,o.t)("Table"),[r.WORLD_MAP]:(0,o.t)("World Map"),[r.BIG_NUMBER]:(0,o.t)("Big Number"),[r.TOP_N]:(0,o.t)("Top 5 Events")}},"./app/views/dashboardsV2/widgetCard.tsx":(e,t,s)=>{s.d(t,{Z:()=>ye});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react/index.js"),n=s("../node_modules/react-lazyload/lib/index.js"),i=s("../node_modules/react-router/es/index.js"),a=s("../node_modules/lodash/isEqual.js"),d=s.n(a),l=s("./app/actionCreators/modal.tsx"),p=s("./app/components/charts/styles.tsx"),c=s("./app/components/errorBoundary.tsx"),u=s("./app/components/featureBadge.tsx"),h=s("./app/components/menuItem.tsx"),m=s("./app/components/organizations/globalSelectionHeader/utils.tsx"),g=s("./app/components/panels/index.tsx"),y=s("./app/components/placeholder.tsx"),v=s("./app/icons/index.tsx"),b=s("./app/locale.tsx"),x=s("./app/styles/overflowEllipsis.tsx"),Z=s("./app/styles/space.tsx"),f=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),w=s("./app/utils/discover/types.tsx"),C=s("./app/utils/withApi.tsx"),_=s("./app/utils/withGlobalSelection.tsx"),j=s("./app/utils/withOrganization.tsx"),R=s("./app/views/dashboardsV2/utils.tsx"),T=s("./app/views/dashboardsV2/widget/utils.tsx"),M=s("./app/views/dashboardsV2/contextMenu.tsx"),q=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),k=s("./app/components/charts/areaChart.tsx"),D=s("./app/components/charts/barChart.tsx"),S=s("./app/components/charts/chartZoom.tsx"),A=s("./app/components/charts/errorPanel.tsx"),P=s("./app/components/charts/lineChart.tsx"),E=s("./app/components/panels/panelTable.tsx"),z=s("./app/utils/discover/fieldRenderers.tsx"),N=s("./app/utils/discover/fields.tsx"),F=s("./app/views/eventsV2/utils.tsx"),L=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class O extends r.Component{renderRow(e,t,s,o){const{location:r,organization:n}=this.props;return o.map((o=>{const i=(0,z.Js)(o.name,s)(t,{organization:n,location:r});return(0,L.tZ)(W,{children:i},"".concat(e,":").concat(o.name))}))}render(){const{className:e,loading:t,fields:s,metadata:o,data:n,title:i}=this.props,a=null!=o?o:{},d=(0,F.Hg)(s.map((e=>({field:e}))));return(0,L.BX)(r.Fragment,{children:[i&&(0,L.tZ)("h4",{children:i}),(0,L.tZ)(B,{className:e,isLoading:t,headers:d.map(((e,t)=>{const s=(0,N.qG)(e.name,e.type,a);return(0,L.tZ)(I,{align:s,children:e.name},t)})),isEmpty:!(null!=n&&n.length),disablePadding:!0,children:null==n?void 0:n.map(((e,t)=>this.renderRow(t,e,a,d)))})]})}}O.displayName="SimpleTableChart";const B=(0,o.Z)(E.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",E.z,"{height:min-content;}"),I=(0,o.Z)("div",{target:"e3tr8vk1"})((e=>e.align?"text-align: ".concat(e.align,";"):"")," padding:",(0,Z.Z)(1)," ",(0,Z.Z)(3),";"),W=(0,o.Z)("div",{target:"e3tr8vk0"})("padding:",(0,Z.Z)(1)," ",(0,Z.Z)(3),";"),X=(0,j.Z)(O);var V=s("./app/components/charts/transitionChart.tsx"),U=s("./app/components/charts/transparentLoadingMask.tsx"),G=s("./app/components/charts/utils.tsx"),J=s("./app/components/charts/worldMapChart.tsx"),Q=s("./app/components/loadingIndicator.tsx"),H=s("./app/utils/discover/charts.tsx"),Y=s("./app/utils/getDynamicText.tsx");class K extends r.Component{shouldComponentUpdate(e){const t={...this.props,widget:{...this.props.widget,title:""}};return e={...e,widget:{...e.widget,title:""}},!d()(t,e)}tableResultComponent({loading:e,errorMessage:t,tableResults:s}){const{location:o,widget:r,organization:n}=this.props;return t?(0,L.tZ)(A.Z,{children:(0,L.tZ)(v.FC,{color:"gray500",size:"lg"})}):void 0===s||e?(0,L.tZ)(y.Z,{height:"200px"}):s.map(((t,i)=>{var a,d;const l=null!==(a=null===(d=r.queries[i])||void 0===d?void 0:d.fields)&&void 0!==a?a:[];return(0,L.tZ)(oe,{location:o,fields:l,title:s.length>1?t.title:"",loading:e,metadata:t.meta,data:t.data,organization:n},"table:".concat(t.title))}))}bigNumberComponent({loading:e,errorMessage:t,tableResults:s}){return t?(0,L.tZ)(A.Z,{children:(0,L.tZ)(v.FC,{color:"gray500",size:"lg"})}):void 0===s||e?(0,L.tZ)(te,{children:"—"}):s.map((e=>{var t;const s=null!==(t=e.meta)&&void 0!==t?t:{},o=Object.keys(null!=s?s:{})[0];if(!o||!e.data.length)return(0,L.tZ)(te,{children:"—"},"big_number:".concat(e.title));const r=e.data[0],n=(0,z.fK)(o,s)(r);return(0,L.tZ)(te,{children:n},"big_number:".concat(e.title))}))}chartComponent(e){const{widget:t}=this.props;switch(t.displayType){case"bar":return(0,L.tZ)(D.Z,{...e});case"area":case"top_n":return(0,L.tZ)(k.Z,{stacked:!0,...e});case"world_map":return(0,L.tZ)(J.Z,{...e});case"line":default:return(0,L.tZ)(P.Z,{...e})}}render(){var e,t,s;const{theme:o,tableResults:r,timeseriesResults:n,errorMessage:i,loading:a,widget:d}=this.props;if("table"===d.displayType)return(0,L.BX)(V.Z,{loading:a,reloading:a,children:[(0,L.tZ)(ee,{loading:a}),this.tableResultComponent({tableResults:r,loading:a,errorMessage:i})]});if("big_number"===d.displayType)return(0,L.BX)(V.Z,{loading:a,reloading:a,children:[(0,L.tZ)(ee,{loading:a}),this.bigNumberComponent({tableResults:r,loading:a,errorMessage:i})]});if(i)return(0,L.tZ)(A.Z,{children:(0,L.tZ)(v.FC,{color:"gray500",size:"lg"})});const{location:l,router:p,selection:c}=this.props,{start:u,end:h,period:m,utc:g}=c.datetime;if("world_map"===d.displayType){const{data:e,title:t}=(0,G.JT)(r),s=[{seriesName:t,data:e}];return(0,L.BX)(V.Z,{loading:a,reloading:a,children:[(0,L.tZ)(ee,{loading:a}),(0,L.tZ)(se,{children:(0,Y.Z)({value:this.chartComponent({series:s}),fixed:(0,L.tZ)(y.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const b={left:0,top:0,selected:(0,G.RI)(l),formatter:e=>{const t=(0,N.hW)(e);if(null!==t){const s=(0,N.b8)(t);null!==s&&(e=s.toUpperCase())}return(0,N.by)(e)&&(e=(0,N.bQ)(e)),e}},x=null!==(e=null===(t=d.queries[0])||void 0===t||null===(s=t.fields)||void 0===s?void 0:s[0])&&void 0!==e?e:"count()",Z={grid:{left:4,right:0,top:"40px",bottom:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:H.CX},yAxis:{axisLabel:{color:o.chartLabel,formatter:e=>(0,H.gu)(e,x)}}};return(0,L.tZ)(S.Z,{router:p,period:m,start:u,end:h,utc:g,children:e=>{if(i)return(0,L.tZ)(A.Z,{children:(0,L.tZ)(v.FC,{color:"gray500",size:"lg"})});const t=n?o.charts.getColorPalette(n.length-2):[];"top_n"===d.displayType&&n&&n.length>5&&(t[t.length-1]=o.chartOther);const s=n?n.map(((e,s)=>({...e,color:t[s]}))):[];return(0,L.BX)(V.Z,{loading:a,reloading:a,children:[(0,L.tZ)(ee,{loading:a}),(0,L.tZ)(se,{children:(0,Y.Z)({value:this.chartComponent({...e,...Z,legend:b,series:s}),fixed:(0,L.tZ)(y.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}K.displayName="WidgetCardChart";const $=(0,o.Z)((e=>(0,L.tZ)(U.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e1od7x483"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),ee=({loading:e})=>e?(0,L.tZ)($,{visible:e,children:(0,L.tZ)(Q.Z,{mini:!0})}):null;ee.displayName="LoadingScreen";const te=(0,o.Z)("div",{target:"e1od7x482"})("font-size:32px;padding:",(0,Z.Z)(1)," ",(0,Z.Z)(3)," ",(0,Z.Z)(3)," ",(0,Z.Z)(3),";*{text-align:left!important;}"),se=(0,o.Z)("div",{target:"e1od7x481"})("padding:0 ",(0,Z.Z)(3)," ",(0,Z.Z)(3),";"),oe=(0,o.Z)(X,{target:"e1od7x480"})("margin-top:",(0,Z.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),re=(0,q.b)(K);var ne=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),ie=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.symbol.description.js"),s("../node_modules/lodash/cloneDeep.js")),ae=s.n(ie),de=s("./app/actionCreators/events.tsx"),le=s("./app/utils/dates.tsx"),pe=s("./app/utils/discover/genericDiscoverQuery.tsx");function ce(e,t){return{seriesName:t,data:e.data.map((([e,t])=>({name:1e3*e,value:t.reduce(((e,{count:t})=>e+t),0)})))}}function ue(e,t){let s=[];const o=e.name;if((0,G.Xe)(t)){const e=Object.keys(t).map((e=>{const s=o?"".concat(o," : ").concat(e):e,r=t[e];return[r.order||0,ce(r,s)]})).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));s=s.concat(e)}else{const r=e.fields[0],n=o?"".concat(o," : ").concat(r):r,i=ce(t,n);s.push(i)}return s}class he extends r.Component{constructor(...e){super(...e),(0,ne.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0}),(0,ne.Z)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,this.fetchData()}componentDidUpdate(e){var t;const{selection:s,widget:o}=this.props,[r,n]=e.widget.queries.map((e=>(e.fields=e.fields.filter((e=>!!e)),e))).reduce((([e,t],{name:s,...o})=>(e.push(s),t.push(o),[e,t])),[[],[]]),[i,a]=o.queries.map((e=>(e.fields=e.fields.filter((e=>!!e&&"equation|"!==e)),e))).reduce((([e,t],{name:s,...o})=>(e.push(s),t.push(o),[e,t])),[[],[]]);d()(o.displayType,e.widget.displayType)&&d()(o.interval,e.widget.interval)&&d()(a,n)&&d()(o.displayType,e.widget.displayType)&&(0,m.WO)(s,e.selection)?this.state.loading||d()(r,i)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==o.queries.length||this.setState((e=>{const t=o.queries.reduce(((t,s,o)=>t.concat(ue(s,e.rawResults[o]))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}componentWillUnmount(){this._isMounted=!1}fetchEventData(e){const{selection:t,api:s,organization:o,widget:r}=this.props;let n=[];this.setState({tableResults:[]});const i=r.queries.map((e=>{const n=(0,R.tT)(r.title,e,t);let i="";const a={per_page:5,noPagination:!0};if("table"===r.displayType)i="/organizations/".concat(o.slug,"/eventsv2/"),a.referrer="api.dashboards.tablewidget";else if("big_number"===r.displayType)i="/organizations/".concat(o.slug,"/eventsv2/"),a.per_page=1,a.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==r.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");i="/organizations/".concat(o.slug,"/events-geo/"),delete a.per_page,a.referrer="api.dashboards.worldmapwidget"}return(0,pe.AA)(s,i,{...n.generateQueryStringObject(),...a})}));let a=0;i.forEach((async(t,s)=>{try{var o,d;const[l]=await t,p=l;if(p.title=null!==(o=null===(d=r.queries[s])||void 0===d?void 0:d.name)&&void 0!==o?o:"",n=[...n,p],!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:n}))}catch(e){var l;const t=(null==e||null===(l=e.responseJSON)||void 0===l?void 0:l.detail)||(0,b.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(a++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:a!==i.length}))}}))}fetchTimeseriesData(e,t){const{selection:s,api:o,organization:r,widget:n}=this.props;this.setState({timeseriesResults:[],rawResults:[]});const{environments:i,projects:a}=s,{start:d,end:l,period:p}=s.datetime,c=function(e,t){let s="bar"===e.displayType?"1d":e.interval;s||(s="5m");const o=(0,le.YJ)(s);return(0,G.Nm)(t)/o>4e3?(0,G.ZS)(t,"high"):s}(n,{start:d,end:l,period:p}),u=n.queries.map((e=>{let s;return"top_n"===n.displayType?(s={organization:r,interval:c,start:d,end:l,project:a,environment:i,period:p,query:e.conditions,yAxis:(0,N.Nk)(e.fields)[0],includePrevious:!1,referrer:"api.dashboards.widget.".concat(t,"-chart"),partial:!0,topEvents:w.hY,field:e.fields},e.orderby&&(s.orderby=e.orderby)):s={organization:r,interval:c,start:d,end:l,project:a,environment:i,period:p,query:e.conditions,yAxis:e.fields,orderby:e.orderby,includePrevious:!1,referrer:"api.dashboards.widget.".concat(t,"-chart"),partial:!0},(0,de.lI)(o,s)}));let h=0;u.forEach((async(t,s)=>{try{const o=await t;if(!this._isMounted)return;this.setState((t=>{var r,i;if(t.queryFetchID!==e)return t;const a=[...null!==(r=t.timeseriesResults)&&void 0!==r?r:[]],d=ue(n.queries[s],o);d.forEach(((e,t)=>{a[s*d.length+t]=e}));const l=ae()(null!==(i=t.rawResults)&&void 0!==i?i:[]);return l[s]=o,{...t,timeseriesResults:a,rawResults:l}}))}catch(e){var o;const t=(null==e||null===(o=e.responseJSON)||void 0===o?void 0:o.detail)||(0,b.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(h++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:h!==u.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t,e.displayType)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:s,tableResults:o,errorMessage:r}=this.state;return e({loading:t,timeseriesResults:null==s?void 0:s.filter((e=>!!e)),tableResults:o,errorMessage:r})}}he.displayName="WidgetQueries";const me=he;class ge extends r.Component{shouldComponentUpdate(e){return!d()(e.widget,this.props.widget)||!(0,m.WO)(e.selection,this.props.selection)||this.props.isEditing!==e.isEditing||this.props.isSorting!==e.isSorting||this.props.hideToolbar!==e.hideToolbar}isAllowWidgetsToDiscover(){const{organization:e}=this.props;return e.features.includes("connect-discover-and-dashboards")}renderToolbar(){const{onEdit:e,onDelete:t,draggableProps:s,hideToolbar:o,isEditing:r}=this.props;return r?(0,L.tZ)(xe,{children:(0,L.BX)(Ze,{style:{visibility:o?"hidden":"visible"},children:[(0,L.tZ)(fe,{children:(0,L.tZ)(we,{color:"textColor",...null==s?void 0:s.listeners,...null==s?void 0:s.attributes})}),(0,L.tZ)(fe,{"data-test-id":"widget-edit",onClick:()=>{e()},children:(0,L.tZ)(v.yl,{color:"textColor"})}),(0,L.tZ)(fe,{"data-test-id":"widget-delete",onClick:()=>{t()},children:(0,L.tZ)(v.Fz,{color:"textColor"})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:s,showContextMenu:o}=this.props;if(!o)return null;const r=[];if(("table"===e.displayType||this.isAllowWidgetsToDiscover())&&s.features.includes("discover-basic")&&e.queries.length){const o=(0,R.tT)(e.title,e.queries[0],t,e.displayType),n=o.getResultsViewUrlTarget(s.slug);if(this.isAllowWidgetsToDiscover()){const t=o.getYAxisOptions().map((({value:e})=>e));switch(n.query.yAxis=e.queries[0].fields.filter((e=>t.includes(e))).slice(0,3),e.displayType){case T.FO.WORLD_MAP:n.query.display=w.DC.WORLDMAP;break;case T.FO.BAR:n.query.display=w.DC.BAR}}1===e.queries.length?r.push((0,L.tZ)(i.Link,{to:n,onClick:()=>{(0,f.Z)("dashboards_views.open_in_discover.opened",{organization:s,widget_type:e.displayType})},children:(0,L.BX)(Re,{children:[(0,b.t)("Open in Discover"),e.displayType!==T.FO.TABLE&&(0,L.tZ)(u.Z,{type:"new",noTooltip:!0})]},"open-discover")},"open-discover-link")):r.push((0,L.tZ)(Re,{onClick:t=>{t.preventDefault(),(0,f.Z)("dashboards_views.query_selector.opened",{organization:s,widget_type:e.displayType}),(0,l.openDashboardWidgetQuerySelectorModal)({organization:s,widget:e})},children:(0,b.t)("Open in Discover")},"open-discover"))}return r.length?(0,L.tZ)(je,{children:(0,L.tZ)(M.Z,{children:r})}):null}render(){const{widget:e,api:t,organization:s,selection:o,renderErrorMessage:i,location:a,router:d}=this.props;return(0,L.tZ)(c.Z,{customComponent:(0,L.tZ)(ve,{children:(0,b.t)("Error loading widget data")}),children:(0,L.BX)(be,{isDragging:!1,children:[(0,L.BX)(_e,{children:[(0,L.tZ)(Ce,{children:e.title}),this.renderContextMenu()]}),(0,L.tZ)(n.ZP,{once:!0,height:200,children:(0,L.tZ)(me,{api:t,organization:s,widget:e,selection:o,children:({tableResults:t,timeseriesResults:n,errorMessage:l,loading:p})=>(0,L.BX)(r.Fragment,{children:["function"==typeof i?i(l):null,(0,L.tZ)(re,{timeseriesResults:n,tableResults:t,errorMessage:l,loading:p,location:a,widget:e,selection:o,router:d,organization:s}),this.renderToolbar()]})})})]})})}}ge.displayName="WidgetCard";const ye=(0,C.Z)((0,j.Z)((0,_.Z)((0,i.withRouter)(ge)))),ve=(0,o.Z)(y.Z,{target:"emngp8q9"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,Z.Z)(2),";"),be=(0,o.Z)(g.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"emngp8q8"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;"),xe=(0,o.Z)("div",{target:"emngp8q7"})("position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),Ze=(0,o.Z)("div",{target:"emngp8q6"})("display:flex;margin:10px ",(0,Z.Z)(2),";touch-action:none;"),fe=(0,o.Z)("div",{target:"emngp8q5"})("padding:",(0,Z.Z)(1),";&:hover{cursor:pointer;}"),we=(0,o.Z)(v.LS,{target:"emngp8q4"})({name:"1fhyj3b",styles:"&:hover{cursor:grab;}"}),Ce=(0,o.Z)(p.Gh,{target:"emngp8q3"})(x.Z,";"),_e=(0,o.Z)("div",{target:"emngp8q2"})("padding:",(0,Z.Z)(2)," ",(0,Z.Z)(3)," 0 ",(0,Z.Z)(3),";width:100%;display:flex;justify-content:space-between;"),je=(0,o.Z)("div",{target:"emngp8q1"})("margin-left:",(0,Z.Z)(1),";"),Re=(0,o.Z)(h.Z,{target:"emngp8q0"})("white-space:nowrap;color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}")}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_widgetCard_tsx.b8cbbe21a20e99d2e880558b7e921f64.js.map