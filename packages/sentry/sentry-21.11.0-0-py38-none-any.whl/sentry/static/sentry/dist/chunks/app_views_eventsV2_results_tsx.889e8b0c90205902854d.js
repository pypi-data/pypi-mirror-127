"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_eventsV2_results_tsx"],{"./app/components/dataExport.tsx":(e,t,n)=>{n.d(t,{tD:()=>v,ZP:()=>Z});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),o=n("../node_modules/lodash/debounce.js"),a=n.n(o),r=n("../node_modules/lodash/isEqual.js"),l=n.n(r),d=n("./app/actionCreators/indicator.tsx"),c=n("./app/components/acl/feature.tsx"),p=n("./app/components/button.tsx"),u=n("./app/locale.tsx"),h=n("./app/utils/withApi.tsx"),m=n("./app/utils/withOrganization.tsx"),g=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let v;!function(e){e.IssuesByTag="Issues-by-Tag",e.Discover="Discover"}(v||(v={}));class y extends i.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",this.initialState),(0,s.Z)(this,"resetState",(()=>{this.setState(this.initialState)})),(0,s.Z)(this,"startDataExport",(()=>{const{api:e,organization:{slug:t},payload:{queryType:n,queryInfo:s}}=this.props;this.setState({inProgress:!0}),e.requestPromise("/organizations/".concat(t,"/data-export/"),{includeAllArgs:!0,method:"POST",data:{query_type:n,query_info:s}}).then((([e,t,n])=>{(0,d.S9)(201===(null==n?void 0:n.status)?(0,u.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,u.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((e=>{var t,n;const s=null!==(t=null==e||null===(n=e.responseJSON)||void 0===n?void 0:n.detail)&&void 0!==t?t:"We tried our hardest, but we couldn't export your data. Give it another go.";(0,d.Iw)((0,u.t)(s)),this.setState({inProgress:!1})}))}))}componentDidUpdate({payload:e}){const{payload:t}=this.props;l()(e,t)||this.resetState()}get initialState(){return{inProgress:!1}}render(){const{inProgress:e}=this.state,{children:t,disabled:n,icon:s}=this.props;return(0,g.tZ)(c.Z,{features:["organizations:discover-query"],children:e?(0,g.tZ)(p.ZP,{size:"small",priority:"default",title:"You can get on with your life. We'll email you when your data's ready.",...this.props,disabled:!0,icon:s,children:(0,u.t)("We're working on it...")}):(0,g.tZ)(p.ZP,{onClick:a()(this.startDataExport,500),disabled:n||!1,size:"small",priority:"default",title:"Put your data to work. Start your export and we'll email you when it's finished.",icon:s,...this.props,children:t||(0,u.t)("Export All to CSV")})})}}y.displayName="DataExport";const Z=(0,h.Z)((0,m.Z)(y))},"./app/views/eventsV2/breadcrumb.tsx":(e,t,n)=>{n.d(t,{Z:()=>c});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=n("../node_modules/react/index.js"),o=n("./app/components/breadcrumbs.tsx"),a=n("./app/locale.tsx"),r=n("./app/utils/discover/urls.tsx"),l=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class d extends i.Component{getCrumbs(){const e=[],{eventView:t,event:n,organization:s,location:i}=this.props,o=s.features.includes("discover-query")?{pathname:(0,r.zR)(s),query:{...i.query,...t.generateBlankQueryStringObject(),...t.getGlobalSelectionQuery()}}:null;return e.push({to:o,label:(0,a.t)("Discover")}),t&&t.isValid()&&e.push({to:t.getResultsViewUrlTarget(s.slug),label:t.name||""}),n&&e.push({label:(0,a.t)("Event Detail")}),e}render(){return(0,l.tZ)(o.Z,{crumbs:this.getCrumbs()})}}d.displayName="DiscoverBreadcrumb",(0,s.Z)(d,"defaultProps",{event:void 0});const c=d},"./app/views/eventsV2/results.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>en});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/react/index.js")),a=n("../node_modules/react-router/es/index.js"),r=n("../node_modules/@sentry/minimal/esm/index.js"),l=n("../node_modules/lodash/isEqual.js"),d=n.n(l),c=n("../node_modules/lodash/omit.js"),p=n.n(c),u=n("./app/actionCreators/discoverSavedQueries.tsx"),h=n("./app/actionCreators/events.tsx"),m=n("./app/actionCreators/projects.tsx"),g=n("./app/actionCreators/tags.tsx"),v=n("./app/api.tsx"),y=n("./app/components/alert.tsx"),Z=n("./app/components/asyncComponent.tsx"),x=n("./app/components/confirm.tsx"),w=n("./app/components/events/searchBar.tsx"),f=n("./app/components/layouts/thirds.tsx"),b=n("./app/components/noProjectMessage.tsx"),C=n("./app/components/organizations/globalSelectionHeader/index.tsx"),D=n("./app/components/organizations/globalSelectionHeader/getParams.tsx"),A=n("./app/components/sentryDocumentTitle.tsx"),z=n("./app/constants/index.tsx"),S=n("./app/icons/index.tsx"),P=n("./app/locale.tsx"),V=n("./app/styles/organization.tsx"),k=n("./app/styles/space.tsx"),q=n("./app/utils.tsx"),T=n("./app/utils/analytics.tsx"),j=n("./app/utils/discover/eventView.tsx"),Q=n("./app/utils/discover/fields.tsx"),E=n("./app/utils/discover/types.tsx"),_=n("./app/utils/localStorage.tsx"),N=n("./app/utils/queryString.tsx"),B=n("./app/utils/withApi.tsx"),L=n("./app/utils/withGlobalSelection.tsx"),I=n("./app/utils/withOrganization.tsx"),O=n("./app/views/performance/utils.tsx"),F=n("./app/views/eventsV2/data.tsx"),R=n("./app/components/charts/areaChart.tsx"),M=n("./app/components/charts/barChart.tsx"),U=n("./app/components/charts/eventsChart.tsx"),W=n("./app/components/charts/utils.tsx"),K=n("./app/components/charts/worldMapChart.tsx"),H=n("./app/components/panels/index.tsx"),X=n("./app/components/placeholder.tsx"),Y=n("./app/utils/dates.tsx"),G=n("./app/utils/getDynamicText.tsx"),J=n("./app/components/acl/feature.tsx"),$=n("./app/components/charts/styles.tsx"),ee=n("./app/components/checkboxFancy/checkboxFancy.tsx"),te=n("./app/components/dropdownBubble.tsx"),ne=n("./app/components/dropdownButton.tsx"),se=n("./app/components/dropdownControl.tsx"),ie=n("./app/components/dropdownMenu.tsx"),oe=n("./app/components/tooltip.tsx"),ae=n("./app/components/truncate.tsx"),re=n("./app/styles/overflowEllipsis.tsx"),le=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class de extends o.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{}),(0,s.Z)(this,"menuContainerRef",(0,o.createRef)())}componentDidMount(){this.setMenuContainerWidth()}shouldComponentUpdate(e,t){return!d()(e,this.props)||!d()(t,this.state)}componentDidUpdate(e){e.selected!==this.props.selected&&this.setMenuContainerWidth()}setMenuContainerWidth(){var e,t;const n=null===(e=this.menuContainerRef)||void 0===e||null===(t=e.current)||void 0===t?void 0:t.offsetWidth;n&&this.setState({menuContainerWidth:n})}constructNewSelected(e){return[e]}selectCheckbox(e){const{selected:t}=this.props;return 1===t.length&&t[0]===e?t:t.includes(e)?t.filter((t=>t!==e)):[...t,e]}shouldBeDisabled({value:e,disabled:t}){const{selected:n}=this.props;return t||n.length>2&&!n.includes(e)}handleCheckboxClick(e,t){const{onChange:n}=this.props;e.stopPropagation(),this.shouldBeDisabled(t)||n(this.selectCheckbox(t.value))}render(){const{menuContainerWidth:e}=this.state,{options:t,onChange:n,selected:s,title:i,menuWidth:a}=this.props,r=t.filter((e=>s.includes(e.value))).map((({label:e})=>e)).join(", ")||"None";return(0,le.BX)($.m2,{children:[(0,le.tZ)($.OT,{children:i}),(0,le.tZ)(ue,{ref:this.menuContainerRef,children:(0,le.tZ)(ie.Z,{alwaysRenderMenu:!1,keepMenuOpen:!0,children:({isOpen:i,getMenuProps:l,getActorProps:d})=>(0,le.BX)(o.Fragment,{children:[(0,le.tZ)(he,{...d(),size:"zero",isOpen:i,children:(0,le.tZ)(ce,{children:String(r)})}),(0,le.tZ)(me,{...l(),alignMenu:"right",width:a,minWidth:e,isOpen:i,blendWithActor:!1,blendCorner:!0,children:t.map((e=>{var t;const i=this.shouldBeDisabled(e);return(0,le.BX)(ge,{onSelect:e=>n(this.constructNewSelected(e)),eventKey:e.value,"data-test-id":"option-".concat(e.value),isChecked:s.includes(e.value),children:[(0,le.tZ)(pe,{isActive:!1,value:String(e.label),maxLength:60,expandDirection:"left"}),!e.checkboxHidden&&(0,le.tZ)(oe.Z,{title:i?(0,P.t)(null!==(t=e.tooltip)&&void 0!==t?t:"Only a maximum of 3 fields can be displayed on the Y-Axis at a time"):void 0,children:(0,le.tZ)(ee.Z,{className:e.value,isChecked:s.includes(e.value),isDisabled:i,onClick:t=>this.handleCheckboxClick(t,e)})})]},e.value)}))})]})})})]})}}de.displayName="OptionCheckboxSelector",(0,s.Z)(de,"defaultProps",{menuWidth:"auto"});const ce=(0,i.Z)("span",{target:"ebanrcg5"})(re.Z,";max-width:400px;"),pe=(0,i.Z)(ae.Z,{target:"ebanrcg4"})("flex:auto;padding-right:",(0,k.Z)(1),";& span{",(e=>e.isActive&&"\n      color: ".concat(e.theme.white,";\n      background: ").concat(e.theme.active,";\n      border: none;\n    ")),";}"),ue=(0,i.Z)("div",{target:"ebanrcg3"})({name:"11ffxfj",styles:"display:inline-block;position:relative"}),he=(0,i.Z)(ne.Z,{target:"ebanrcg2"})("padding:",(0,k.Z)(1)," ",(0,k.Z)(2),";font-weight:normal;z-index:",(e=>e.isOpen?e.theme.zIndex.dropdownAutocomplete.actor:"auto"),";"),me=(0,i.Z)(te.Z,{target:"ebanrcg1"})("display:",(e=>e.isOpen?"block":"none"),";overflow:visible;",(e=>e.minWidth&&"auto"===e.width&&"min-width: calc(".concat(e.minWidth,"px + ").concat((0,k.Z)(3),")")),";"),ge=(0,i.Z)(se.hP,{target:"ebanrcg0"})("line-height:",(e=>e.theme.text.lineHeightBody),";white-space:nowrap;",ee.Z,"{opacity:",(e=>e.isChecked?1:.3),";}&:hover ",ee.Z,"{opacity:1;}"),ve=de;var ye=n("./app/components/charts/optionSelector.tsx");function Ze({organization:e,total:t,yAxisValue:n,yAxisOptions:s,onAxisChange:i,displayMode:o,displayOptions:a,onDisplayChange:r,onTopEventsChange:l,topEvents:d}){const c=[];c.push((0,le.tZ)($.OT,{children:(0,P.t)("Total Events")},"total-label")),c.push(null===t?(0,le.tZ)($.uN,{"data-test-id":"loading-placeholder",children:"â€”"},"total-value"):(0,le.tZ)($.uN,{children:t.toLocaleString()},"total-value"));const p=[];for(let e=1;e<=10;e++)p.push({value:e.toString(),label:e.toString()});return(0,le.BX)($.xx,{children:[(0,le.tZ)($.m2,{children:c}),(0,le.BX)($.m2,{children:[(0,le.tZ)(ye.Z,{title:(0,P.t)("Display"),selected:o,options:a,onChange:r,menuWidth:"170px"}),(0,le.tZ)(J.Z,{organization:e,features:["discover-top-events"],children:({hasFeature:e})=>e&&E.v2.includes(o)?(0,le.tZ)(ye.Z,{title:(0,P.t)("Limit"),selected:d,options:p,onChange:l,menuWidth:"60px",featureType:"new"}):null}),(0,le.tZ)(J.Z,{organization:e,features:["connect-discover-and-dashboards"],children:({hasFeature:e})=>e?(0,le.tZ)(ve,{title:(0,P.t)("Y-Axis"),selected:n,options:s,onChange:i}):(0,le.tZ)(ye.Z,{title:(0,P.t)("Y-Axis"),selected:n[0],options:s,onChange:e=>i([e])})})]})]})}Ze.displayName="ChartFooter";class xe extends o.Component{shouldComponentUpdate(e){const{eventView:t,...n}=this.props,{eventView:s,...i}=e;return!t.isEqualTo(s)||!d()(n,i)}render(){const{api:e,eventView:t,location:n,organization:s,router:i,confirmedQuery:a,yAxisValue:r}=this.props,l=s.features.includes("performance-chart-interpolation"),d=s.features.includes("connect-discover-and-dashboards"),c=s.features.includes("discover-top-events"),p=t.getGlobalSelection(),u=p.datetime.start?(0,Y.hC)(p.datetime.start):null,h=p.datetime.end?(0,Y.hC)(p.datetime.end):null,{utc:m}=(0,D.Q)(n.query),g=t.getEventsAPIPayload(n),v=t.getDisplayMode(),y=v===E.DC.TOP5||v===E.DC.DAILYTOP5,Z=v===E.DC.DEFAULT||v===E.DC.TOP5,x=v===E.DC.DAILYTOP5||v===E.DC.DAILY,w=v===E.DC.PREVIOUS,f="api.discover.".concat(v,"-chart"),b=c&&t.topEvents?parseInt(t.topEvents,10):E.hY,C=v===E.DC.WORLDMAP?K.Z:v===E.DC.BAR?M.Z:d&&r.length>1&&!x?R.Z:void 0,A=v===E.DC.BAR?(0,W.ZS)({start:u,end:h,period:p.datetime.period,utc:"true"===m},"low"):t.interval;return(0,le.tZ)(o.Fragment,{children:(0,G.Z)({value:(0,le.tZ)(U.Z,{api:e,router:i,query:g.query,organization:s,showLegend:!0,yAxis:r,projects:p.projects,environments:p.environments,start:u,end:h,period:p.datetime.period,disablePrevious:!w,disableReleases:!Z,field:y?g.field:void 0,interval:A,showDaily:x,topEvents:y?b:void 0,orderby:y?(0,N.ro)(g.sort):void 0,utc:"true"===m,confirmedQuery:a,withoutZerofill:l,chartComponent:C,referrer:f,fromDiscover:!0}),fixed:(0,le.tZ)(X.Z,{height:"200px",testId:"skeleton-ui"})})})}}xe.displayName="ResultsChart";class we extends o.Component{shouldComponentUpdate(e){const{eventView:t,...n}=this.props,{eventView:s,...i}=e;return!t.isEqualTo(s)||this.props.confirmedQuery!==e.confirmedQuery||!d()(n,i)}render(){var e;const{api:t,eventView:n,location:s,router:i,total:o,onAxisChange:a,onDisplayChange:r,onTopEventsChange:l,organization:d,confirmedQuery:c,yAxis:p}=this.props,u=d.features.includes("discover-query"),h=d.features.includes("connect-discover-and-dashboards"),m=d.features.includes("discover-top-events"),g=n.getDisplayOptions().filter((e=>!([E.DC.TOP5,E.DC.DAILYTOP5].includes(e.value)&&!u||!h&&e.value===E.DC.WORLDMAP))).map((e=>(m&&[E.DC.TOP5,E.DC.DAILYTOP5].includes(e.value)&&(e.label=E.DC.TOP5===e.value?"Top Period":"Top Daily"),p.length>1&&!E.px.includes(e.value)?{...e,disabled:!0,tooltip:(0,P.t)("Change the Y-Axis dropdown to display only 1 function to use this view.")}:e))),v=h?p:[n.getYAxis()];let y=n.getYAxisOptions();return E.px.includes(n.getDisplayMode())||(y=y.map((e=>({...e,disabled:!0,tooltip:(0,P.t)("Multiple Y-Axis cannot be plotted on this Display mode."),checkboxHidden:!0})))),n.getDisplayMode()===E.DC.WORLDMAP&&(y=y.filter((({value:e})=>!(0,Q.GO)(e)))),(0,le.BX)(be,{children:[v.length>0&&(0,le.tZ)(xe,{api:t,eventView:n,location:s,organization:d,router:i,confirmedQuery:c,yAxisValue:v})||(0,le.tZ)(Ce,{children:(0,P.t)("No Y-Axis selected.")}),(0,le.tZ)(Ze,{organization:d,total:o,yAxisValue:v,yAxisOptions:y,onAxisChange:a,displayOptions:g,displayMode:n.getDisplayMode(),onDisplayChange:r,onTopEventsChange:l,topEvents:null!==(e=n.topEvents)&&void 0!==e?e:E.hY.toString()})]})}}we.displayName="ResultsChartContainer";const fe=(0,B.Z)(we),be=(0,i.Z)(H.s_,{target:"eihhj0r1"})("@media (min-width: ",(e=>e.theme.breakpoints[1]),"){margin:0;}"),Ce=(0,i.Z)("div",{target:"eihhj0r0"})("display:flex;flex-direction:column;justify-content:center;align-items:center;flex:1;flex-shrink:0;overflow:hidden;height:",(e=>e.height||"200px"),";position:relative;border-color:transparent;margin-bottom:0;color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeExtraLarge),";");var De=n("./app/components/timeSince.tsx"),Ae=n("./app/views/eventsV2/breadcrumb.tsx"),ze=n("./app/components/editableText.tsx"),Se=n("./app/utils/useApi.tsx"),Pe=n("./app/views/eventsV2/savedQuery/utils.tsx");const Ve=(0,P.t)("Untitled query");function ke({organization:e,eventView:t,savedQuery:n}){const s=(0,Se.Z)(),i=t.name||Ve;return(0,le.tZ)(qe,{"data-test-id":"discover2-query-name-".concat(i),children:(0,le.tZ)(ze.Z,{value:i,onChange:function(i){if(!n||n.name===i)return;const o=j.ZP.fromSavedQuery({...n,name:i});(0,Pe.pb)(s,e,o).then((n=>{const s=t.clone();s.name=i,a.browserHistory.push(s.getResultsViewUrlTarget(e.slug))}))},isDisabled:!t.id,errorMessage:(0,P.t)("Please set a name for this query")})})}ke.displayName="EventInputName";const qe=(0,i.Z)(f.Dx,{target:"emb7zth0"})({name:"12brwd0",styles:"overflow:unset"}),Te=ke;var je=n("./app/actionCreators/modal.tsx"),Qe=n("./app/components/acl/featureDisabled.tsx"),Ee=n("./app/components/assistant/guideAnchor.tsx"),_e=n("./app/components/banner.tsx"),Ne=n("./app/components/button.tsx"),Be=n("./app/components/buttonBar.tsx"),Le=n("./app/components/createAlertButton.tsx"),Ie=n("./app/components/featureBadge.tsx"),Oe=n("./app/components/hovercard.tsx"),Fe=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),Re=n("./app/utils/discover/urls.tsx"),Me=n("./app/utils/withProjects.tsx"),Ue=n("./app/views/settings/components/forms/controls/input.tsx");class We extends o.PureComponent{constructor(...e){super(...e),(0,s.Z)(this,"state",{isNewQuery:!0,isEditingQuery:!1,queryName:""}),(0,s.Z)(this,"onBlurInput",(e=>{const t=e.target;this.setState({queryName:t.value})})),(0,s.Z)(this,"onChangeInput",(e=>{const t=e.target;this.setState({queryName:t.value})})),(0,s.Z)(this,"handleCreateQuery",(e=>{e.preventDefault(),e.stopPropagation();const{api:t,organization:n,eventView:s,yAxis:i}=this.props;if(!this.state.queryName)return;const o=s.clone();o.name=this.state.queryName;const r=!s.id;(0,Pe.b2)(t,n,o,i,r).then((e=>{const t=j.ZP.fromSavedQuery(e);_e.Z.dismiss("discover"),this.setState({queryName:""}),a.browserHistory.push(t.getResultsViewUrlTarget(n.slug))}))})),(0,s.Z)(this,"handleUpdateQuery",(e=>{e.preventDefault(),e.stopPropagation();const{api:t,organization:n,eventView:s,updateCallback:i,yAxis:o}=this.props;(0,Pe.O$)(t,n,s,o).then((e=>{const t=j.ZP.fromSavedQuery(e);this.setState({queryName:""}),a.browserHistory.push(t.getResultsViewShortUrlTarget(n.slug)),i()}))})),(0,s.Z)(this,"handleDeleteQuery",(e=>{e.preventDefault(),e.stopPropagation();const{api:t,organization:n,eventView:s}=this.props;(0,Pe.Uc)(t,n,s).then((()=>{a.browserHistory.push({pathname:(0,Re.zR)(n),query:{}})}))})),(0,s.Z)(this,"handleCreateAlertSuccess",(()=>{const{organization:e}=this.props;(0,T.ec)({eventKey:"discover_v2.create_alert_clicked",eventName:"Discoverv2: Create alert clicked",status:"success",organization_id:e.id,url:window.location.href})})),(0,s.Z)(this,"handleAddDashboardWidget",(()=>{var e;const{organization:t,eventView:n,savedQuery:s,yAxis:i}=this.props,o=n.sorts[0],a={name:"",fields:i&&i.length>0?i:["count()"],conditions:n.query,orderby:o?"".concat("desc"===o.kind?"-":"").concat(o.field):""};(0,Fe.Z)("discover_views.add_to_dashboard.modal_open",{organization:t,saved_query:!!s}),(0,je.openAddDashboardWidgetModal)({organization:t,fromDiscover:!0,defaultWidgetQuery:a,defaultTableColumns:n.fields.map((({field:e})=>e)),defaultTitle:null!==(e=null==s?void 0:s.name)&&void 0!==e?e:"All Events"!==n.name?n.name:void 0,displayType:(0,Pe.zz)(n.display)})}))}static getDerivedStateFromProps(e,t){const{eventView:n,savedQuery:s,savedQueryLoading:i,yAxis:o}=e;if(!s)return{isNewQuery:!0,isEditingQuery:!1,queryName:t.queryName||""};if(i)return t;const a=j.ZP.fromSavedQuery(s);if(a.id!==n.id)return{isNewQuery:!1,isEditingQuery:!1,queryName:""};const r=n.isEqualTo(a),l=d()(o,s.yAxis?"string"==typeof s.yAxis?[s.yAxis]:s.yAxis:["count()"]);return{isNewQuery:!1,isEditingQuery:!r||!l,queryName:t.queryName||""}}renderButtonSaveAs(e){const{queryName:t}=this.state;return(0,le.tZ)(se.ZP,{alignRight:!0,menuWidth:"220px",priority:"default",buttonProps:{"aria-label":(0,P.t)("Save as"),showChevron:!1,icon:(0,le.tZ)(S.GK,{}),disabled:e},label:"".concat((0,P.t)("Save as"),"â€¦"),children:(0,le.BX)(He,{onClick:We.stopEventPropagation,children:[(0,le.tZ)(Xe,{type:"text",name:"query_name",placeholder:(0,P.t)("Display name"),value:t||"",onBlur:this.onBlurInput,onChange:this.onChangeInput,disabled:e}),(0,le.tZ)(Ne.ZP,{onClick:this.handleCreateQuery,priority:"primary",disabled:e||!this.state.queryName,style:{width:"100%"},children:(0,P.t)("Save for Org")})]})})}renderButtonSave(e){const{isNewQuery:t,isEditingQuery:n}=this.state;return t||n?!t&&n?(0,le.BX)(o.Fragment,{children:[(0,le.BX)(Ne.ZP,{onClick:this.handleUpdateQuery,"data-test-id":"discover2-savedquery-button-update",disabled:e,children:[(0,le.tZ)(Ye,{}),(0,P.t)("Save Changes")]}),this.renderButtonSaveAs(e)]}):this.renderButtonSaveAs(e):(0,le.tZ)(Ne.ZP,{icon:(0,le.tZ)(S.GK,{color:"yellow100",isSolid:!0,size:"sm"}),disabled:!0,"data-test-id":"discover2-savedquery-button-saved",children:(0,P.t)("Saved for Org")})}renderButtonDelete(e){const{isNewQuery:t}=this.state;return t?null:(0,le.tZ)(Ne.ZP,{"data-test-id":"discover2-savedquery-button-delete",onClick:this.handleDeleteQuery,disabled:e,icon:(0,le.tZ)(S.Fz,{})})}renderButtonCreateAlert(){const{eventView:e,organization:t,projects:n,onIncompatibleAlertQuery:s}=this.props;return(0,le.tZ)(Ee.Z,{target:"create_alert_from_discover",children:(0,le.tZ)(Le.K,{eventView:e,organization:t,projects:n,onIncompatibleQuery:s,onSuccess:this.handleCreateAlertSuccess,referrer:"discover","data-test-id":"discover2-create-from-discover"})})}renderButtonAddToDashboard(){return(0,le.BX)(Ge,{onClick:this.handleAddDashboardWidget,children:[(0,P.t)("Add to Dashboard")," ",(0,le.tZ)(Je,{type:"new",noTooltip:!0})]},"add-dashboard-widget-from-discover")}render(){const{organization:e}=this.props,t=e=>(0,le.tZ)(Oe.ZP,{body:(0,le.tZ)(Qe.Z,{features:e.features,hideHelpToggle:!0,message:(0,P.t)("Discover queries are disabled"),featureName:(0,P.t)("Discover queries")}),children:e.children(e)}),n=n=>(0,le.tZ)(J.Z,{organization:e,features:["discover-query"],hookName:"feature-disabled:discover-saved-query-create",renderDisabled:t,children:({hasFeature:e})=>n(!e||this.props.disabled)});return(0,le.BX)(Ke,{gap:1,children:[n((e=>this.renderButtonSave(e))),(0,le.tZ)(J.Z,{organization:e,features:["incidents"],children:({hasFeature:e})=>e&&this.renderButtonCreateAlert()}),(0,le.tZ)(J.Z,{organization:e,features:["connect-discover-and-dashboards","dashboards-edit"],children:({hasFeature:e})=>e&&this.renderButtonAddToDashboard()}),n((e=>this.renderButtonDelete(e)))]})}}We.displayName="SavedQueryButtonGroup",(0,s.Z)(We,"stopEventPropagation",(e=>{e.target instanceof Element&&["LI","INPUT"].includes(e.target.nodeName)&&(e.preventDefault(),e.stopPropagation())})),(0,s.Z)(We,"defaultProps",{disabled:!1});const Ke=(0,i.Z)(Be.ZP,{target:"e1nw12tj5"})("@media (min-width: ",(e=>e.theme.breakpoints[1]),"){margin-top:0;}"),He=(0,i.Z)("div",{target:"e1nw12tj4"})("display:flex;flex-direction:column;padding:",(0,k.Z)(1),";gap:",(0,k.Z)(1),";"),Xe=(0,i.Z)(Ue.Z,{target:"e1nw12tj3"})({name:"1k18kha",styles:"height:40px"}),Ye=(0,i.Z)("div",{target:"e1nw12tj2"})("display:inline-block;width:10px;height:10px;margin-right:",(0,k.Z)(.75),";border-radius:5px;background-color:",(e=>e.theme.yellow300),";"),Ge=(0,i.Z)(Ne.ZP,{target:"e1nw12tj1"})({name:"1y9409g",styles:"span{height:38px;}"}),Je=(0,i.Z)(Ie.Z,{target:"e1nw12tj0"})({name:"1qmr6ab",styles:"overflow:auto"}),$e=(0,Me.Z)((0,B.Z)(We));class et extends o.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{savedQuery:void 0,loading:!0})}componentDidMount(){this.props.eventView.id&&this.fetchData()}componentDidUpdate(e){e.eventView&&this.props.eventView&&e.eventView.id!==this.props.eventView.id&&this.fetchData()}fetchData(){const{api:e,eventView:t,organization:n}=this.props;"string"==typeof t.id&&(this.setState({loading:!0}),(0,u.Yi)(e,n.slug,t.id).then((e=>{this.setState({savedQuery:e,loading:!1})})))}renderAuthor(){const{eventView:e}=this.props,{savedQuery:t}=this.state;if(!e.id)return null;let n=" â€” ",s=" â€” ";var i;return void 0!==t&&(n=(null===(i=t.createdBy)||void 0===i?void 0:i.email)||"â€”",s=(0,le.tZ)(De.Z,{date:t.dateUpdated})),(0,le.BX)(tt,{children:[(0,P.t)("Created by:")," ",n," | ",(0,P.t)("Last edited:")," ",s]})}render(){const{organization:e,location:t,errorCode:n,eventView:s,onIncompatibleAlertQuery:i,yAxis:o}=this.props,{savedQuery:a,loading:r}=this.state;return(0,le.BX)(f.h4,{children:[(0,le.BX)(nt,{children:[(0,le.tZ)(Ae.Z,{eventView:s,organization:e,location:t}),(0,le.tZ)(Te,{savedQuery:a,organization:e,eventView:s}),this.renderAuthor()]}),(0,le.tZ)(f.kP,{children:(0,le.tZ)($e,{location:t,organization:e,eventView:s,savedQuery:a,savedQueryLoading:r,disabled:n>=400&&n<500,updateCallback:()=>this.fetchData(),onIncompatibleAlertQuery:i,yAxis:o})})]})}}et.displayName="ResultsHeader";const tt=(0,i.Z)("h4",{target:"e1idqj2c1"})("font-size:",(e=>e.theme.fontSizeLarge),";font-weight:normal;color:",(e=>e.theme.gray300),";margin:",(0,k.Z)(.5)," 0 0 0;"),nt=(0,i.Z)(f.oB,{target:"e1idqj2c0"})({name:"12brwd0",styles:"overflow:unset"}),st=(0,B.Z)(et);n("../node_modules/core-js/modules/es.symbol.description.js");var it=n("./app/components/pagination.tsx"),ot=n("./app/utils/measurements/measurements.tsx"),at=n("./app/utils/parseLinkHeader.tsx");const rt=["spans.browser","spans.http","spans.db","spans.resource"];var lt=n("./app/utils/withTags.tsx"),dt=n("./app/components/gridEditable/index.tsx"),ct=n("./app/components/gridEditable/sortLink.tsx"),pt=n("./app/components/links/link.tsx"),ut=n("./app/utils/discover/fieldRenderers.tsx"),ht=n("./app/utils/tokenizeSearch.tsx"),mt=n("./app/views/performance/traceDetails/utils.tsx"),gt=n("./app/views/performance/transactionSummary/utils.tsx"),vt=n("./app/views/eventsV2/utils.tsx"),yt=n("./app/views/eventsV2/table/cellAction.tsx"),Zt=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),xt=n("./app/components/links/externalLink.tsx"),wt=n("./app/utils/theme.tsx"),ft=n("./app/views/eventsV2/table/columnEditCollection.tsx");class bt extends o.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{columns:this.props.columns}),(0,s.Z)(this,"handleChange",(e=>{this.setState({columns:e})})),(0,s.Z)(this,"handleApply",(()=>{this.props.onApply(this.state.columns),this.props.closeModal()}))}componentDidMount(){const{organization:e}=this.props;(0,T.ec)({eventKey:"discover_v2.column_editor.open",eventName:"Discoverv2: Open column editor",organization_id:parseInt(e.id,10)})}render(){const{Header:e,Body:t,Footer:n,tagKeys:s,measurementKeys:i,spanOperationBreakdownKeys:a,organization:r}=this.props,l=(0,vt.R0)({organization:r,tagKeys:s,measurementKeys:i,spanOperationBreakdownKeys:a});return(0,le.BX)(o.Fragment,{children:[(0,le.tZ)(e,{closeButton:!0,children:(0,le.tZ)("h4",{children:(0,P.t)("Edit Columns")})}),(0,le.BX)(t,{children:[(0,le.tZ)(Ct,{children:(0,P._N)("To group events, add [functionLink: functions] f(x) that may take in additional parameters. [tagFieldLink: Tag and field] columns will help you view more details about the events (i.e. title).",{functionLink:(0,le.tZ)(xt.Z,{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns"}),tagFieldLink:(0,le.tZ)(xt.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/#event-properties"})})}),(0,le.tZ)(ft.Z,{columns:this.state.columns,fieldOptions:l,onChange:this.handleChange,organization:r})]}),(0,le.tZ)(n,{children:(0,le.BX)(Be.ZP,{gap:1,children:[(0,le.tZ)(Ne.ZP,{priority:"default",href:z.l5,external:!0,children:(0,P.t)("Read the Docs")}),(0,le.tZ)(Ne.ZP,{label:(0,P.t)("Apply"),priority:"primary",onClick:this.handleApply,children:(0,P.t)("Apply")})]})})]})}}bt.displayName="ColumnEditModal";const Ct=(0,i.Z)("div",{target:"e2ihjqm0"})("margin-bottom:",(0,k.Z)(4),";"),Dt=(0,Zt.iv)("@media (min-width: ",wt.ZP.breakpoints[1],"){width:auto;max-width:900px;}",""),At=bt;var zt=n("./app/components/dataExport.tsx");function St(e,t){return(0,le.tZ)(J.Z,{features:["organizations:discover-query"],renderDisabled:()=>Pt(e,t),children:Vt(e,t)})}function Pt(e,t){const{isLoading:n,error:s}=t,i=n||null!==s||!1===e,o=i?void 0:()=>function(e,{organization:t,eventView:n,tableData:s}){(0,T.ec)({eventKey:"discover_v2.results.download_csv",eventName:"Discoverv2: Download CSV",organization_id:parseInt(t.id,10)}),(0,vt.Di)(s,n.getColumns(),e)}(t.title,t);return(0,le.tZ)(Ne.ZP,{size:"small",disabled:i,onClick:o,"data-test-id":"grid-download-csv",icon:(0,le.tZ)(S.Dj,{size:"xs"}),children:(0,P.t)("Export")})}function Vt(e,t){const{isLoading:n,error:s,location:i,eventView:o}=t,a=n||null!==s||!1===e;return(0,le.tZ)(zt.ZP,{payload:{queryType:zt.tD.Discover,queryInfo:o.getEventsAPIPayload(i)},disabled:a,icon:(0,le.tZ)(S.Dj,{size:"xs"}),children:(0,P.t)("Export All")})}function kt(e,t){const n=e?t.onEdit:void 0;return(0,le.tZ)(Ee.Z,{target:"columns_header_button",children:(0,le.tZ)(Ne.ZP,{size:"small",disabled:!e,onClick:n,"data-test-id":"grid-edit-enable",icon:(0,le.tZ)(S.bv,{size:"xs"}),children:(0,P.t)("Columns")})})}function qt({onChangeShowTags:e,showTags:t}){return(0,le.tZ)(Ne.ZP,{size:"small",onClick:e,icon:(0,le.tZ)(S.Ah,{size:"xs"}),children:t?(0,P.t)("Hide Tags"):(0,P.t)("Show Tags")})}function Tt(e){const t=(0,P.t)("Requires discover query feature.");return(0,le.tZ)(J.Z,{hookName:"feature-disabled:grid-editable-actions",renderDisabled:e=>(0,le.tZ)(Oe.ZP,{body:(0,le.tZ)(Qe.Z,{features:e.features,hideHelpToggle:!0,message:t,featureName:t}),children:e.children(e)}),features:["organizations:discover-query"],children:({hasFeature:t})=>e.children(t,e)})}function jt(e){return(0,le.BX)(o.Fragment,{children:[(0,Zt.az)(Tt,{...e,key:"edit"},kt),(0,Zt.az)(Tt,{...e,key:"download"},St),qt(e)]})}St.displayName="renderDownloadButton",Pt.displayName="renderBrowserExportButton",Vt.displayName="renderAsyncExportButton",kt.displayName="renderEditButton",qt.displayName="renderSummaryButton",Tt.displayName="FeatureWrapper",jt.displayName="HeaderActions";const Qt=jt;class Et extends o.Component{constructor(...e){super(...e),(0,s.Z)(this,"_resizeColumn",((e,t)=>{const{location:n,eventView:s}=this.props,i=t.width?Number(t.width):dt.z7,o=s.withResizedColumn(e,i);(0,vt.TX)({location:n,nextEventView:o,extraQuery:(0,j.QN)(n)})})),(0,s.Z)(this,"_renderPrependColumns",((e,t,n)=>{const{organization:s,eventView:i,tableData:o,location:a}=this.props,l=i.hasAggregateField(),d=i.hasIdField();if(e)return l?[(0,le.tZ)(_t,{children:(0,le.tZ)(S.bv,{size:"sm"})},"header-icon")]:d?[]:[(0,le.tZ)(_t,{children:(0,le.tZ)(ct.Z,{align:"left",title:(0,P.t)("event id"),direction:void 0,canSort:!1,generateSortLink:()=>{}})},"header-event-id")];if(l){const e=(0,vt.Bn)(i,{},t),s={pathname:a.pathname,query:e.generateQueryStringObject()};return[(0,le.tZ)(oe.Z,{title:(0,P.t)("Open Group"),children:(0,le.tZ)(pt.Z,{to:s,"data-test-id":"open-group",onClick:()=>{e.isEqualTo(i)&&r.Tb(new Error("Failed to drilldown"))},children:(0,le.tZ)(Lt,{size:"sm"})})},"eventlink".concat(n))]}if(!d){let e=t.id;o&&o.meta&&(e=(0,ut.Js)("id",o.meta)(t,{organization:s,location:a}));const r=(0,Re.JE)(t),l=(0,Re.eQ)({orgSlug:s.slug,eventSlug:r,eventView:i});return[(0,le.tZ)(oe.Z,{title:(0,P.t)("View Event"),children:(0,le.tZ)(Bt,{"data-test-id":"view-event",to:l,children:e})},"eventlink".concat(n))]}return[]})),(0,s.Z)(this,"_renderGridHeaderCell",(e=>{const{eventView:t,location:n,tableData:s}=this.props,i=null==s?void 0:s.meta,o=(0,Q.qG)(e.name,e.type,i),a={field:e.name,width:e.width},r=t.sortForField(a,i),l=(0,j.M3)(a,i),d=(0,Q.uI)(e.name)?t.getEquations()[(0,Q.G5)(e.name)]:e.name,c=(0,le.tZ)(Nt,{title:d,children:(0,le.tZ)(ae.Z,{value:d,maxLength:60,expandable:!1})});return(0,le.tZ)(ct.Z,{align:o,title:c,direction:r?r.kind:void 0,canSort:l,generateSortLink:function(){if(!i)return;const e=t.sortOnField(a,i).generateQueryStringObject();return e.yAxis=(0,N.qP)(n.query.yAxis),{...n,query:e}}})})),(0,s.Z)(this,"_renderGridBodyCell",((e,t,n,s)=>{var i,a;const{isFirstPage:r,eventView:l,location:d,organization:c,tableData:p}=this.props;if(!p||!p.meta)return t[e.key];const u=String(e.key),h=(0,ut.Js)(u,p.meta),m=l.getDisplayMode(),g=m===E.DC.TOP5||m===E.DC.DAILYTOP5,v=l.topEvents?parseInt(l.topEvents,10):E.hY,y=Math.min(null!==(i=null==p||null===(a=p.data)||void 0===a?void 0:a.length)&&void 0!==i?i:v,v);let Z=h(t,{organization:c,location:d});if("id"===u){const e=(0,Re.JE)(t),n=(0,Re.eQ)({orgSlug:c.slug,eventSlug:e,eventView:l});Z=(0,le.tZ)(oe.Z,{title:(0,P.t)("View Event"),children:(0,le.tZ)(Bt,{"data-test-id":"view-event",to:n,children:Z})})}else if("trace"===u){const e=l.normalizeDateSelection(d);if(t.trace){const n=(0,mt.YA)(c,String(t.trace),e,{});Z=(0,le.tZ)(oe.Z,{title:(0,P.t)("View Trace"),children:(0,le.tZ)(Bt,{"data-test-id":"view-trace",to:n,children:Z})})}}const x=(0,Q.LY)(u),w=t[x];return"integer"===p.meta[x]&&(0,q.ri)(w)&&w>999?(0,le.tZ)(oe.Z,{title:w.toLocaleString(),containerDisplayMode:"block",position:"right",children:(0,le.tZ)(yt.ZP,{column:e,dataRow:t,handleCellAction:this.handleCellAction(t,e),children:Z})}):(0,le.BX)(o.Fragment,{children:[r&&g&&n<v&&0===s?(0,le.tZ)(It,{count:y,index:n}):null,(0,le.tZ)(yt.ZP,{column:e,dataRow:t,handleCellAction:this.handleCellAction(t,e),children:Z})]})})),(0,s.Z)(this,"handleEditColumns",(()=>{const{organization:e,eventView:t,tagKeys:n,measurementKeys:s,spanOperationBreakdownKeys:i}=this.props,o=e.features.includes("performance-ops-breakdown");(0,je.openModal)((a=>(0,le.tZ)(At,{...a,organization:e,tagKeys:n,measurementKeys:s,spanOperationBreakdownKeys:o?i:void 0,columns:t.getColumns().map((e=>e.column)),onApply:this.handleUpdateColumns})),{modalCss:Dt,backdrop:"static"})})),(0,s.Z)(this,"handleCellAction",((e,t)=>(n,s)=>{const{eventView:i,organization:o,projects:r,location:l}=this.props,d=new ht.MY(i.query);let c=i.clone();switch((0,T.ec)({eventKey:"discover_v2.results.cellaction",eventName:"Discoverv2: Cell Action Clicked",organization_id:parseInt(o.id,10),action:n}),n){case yt.eX.TRANSACTION:{const t=r.find((t=>t.slug===e.project)),n=t?[t.id]:void 0,i=(0,gt.e1)({orgSlug:o.slug,transaction:String(s),projectID:n,query:c.getGlobalSelectionQuery()});return void a.browserHistory.push(i)}case yt.eX.RELEASE:{const t=r.find((t=>t.slug===e.project));return void a.browserHistory.push({pathname:"/organizations/".concat(o.slug,"/releases/").concat(encodeURIComponent(s),"/"),query:{...c.getGlobalSelectionQuery(),project:t?t.id:void 0}})}case yt.eX.DRILLDOWN:return(0,T.ec)({eventKey:"discover_v2.results.drilldown",eventName:"Discoverv2: Click aggregate drilldown",organization_id:parseInt(o.id,10)}),c=(0,vt.Bn)(c,{},e).withNewColumn({kind:"function",function:["count","",void 0,void 0]}),void a.browserHistory.push(c.getResultsViewUrlTarget(o.slug));default:(0,yt.rh)(d,n,t,s)}c.query=d.formatString();const p=c.getResultsViewUrlTarget(o.slug);p.query.yAxis=(0,N.qP)(l.query.yAxis),a.browserHistory.push(p)})),(0,s.Z)(this,"handleUpdateColumns",(e=>{const{organization:t,eventView:n,location:s}=this.props;(0,T.ec)({eventKey:"discover_v2.update_columns",eventName:"Discoverv2: Update columns",organization_id:parseInt(t.id,10)});const i=n.withColumns(e),o=i.getResultsViewUrlTarget(t.slug),r=(0,N.qP)(s.query.yAxis);o.query.yAxis=r.filter((e=>i.getYAxisOptions().find((({value:t})=>t===e)))),a.browserHistory.push(o)})),(0,s.Z)(this,"renderHeaderButtons",(()=>{const{organization:e,title:t,eventView:n,isLoading:s,error:i,tableData:o,location:a,onChangeShowTags:r,showTags:l}=this.props;return(0,le.tZ)(Qt,{title:t,isLoading:s,error:i,organization:e,eventView:n,onEdit:this.handleEditColumns,tableData:o,location:a,onChangeShowTags:r,showTags:l})}))}render(){const{isLoading:e,error:t,location:n,tableData:s,eventView:i}=this.props,o=i.getColumns(),a=i.getSorts(),r=i.hasAggregateField()?["40px"]:i.hasIdField()?[]:["minmax(".concat(dt.zO,"px, max-content)")];return(0,le.tZ)(dt.ZP,{isLoading:e,error:t,data:s?s.data:[],columnOrder:o,columnSortBy:a,title:(0,P.t)("Results"),grid:{renderHeadCell:this._renderGridHeaderCell,renderBodyCell:this._renderGridBodyCell,onResizeColumn:this._resizeColumn,renderPrependColumns:this._renderPrependColumns,prependColumnWidths:r},headerButtons:this.renderHeaderButtons,location:n})}}Et.displayName="TableView";const _t=(0,i.Z)("span",{target:"ecjx3jw4"})("color:",(e=>e.theme.subText),";"),Nt=(0,i.Z)(oe.Z,{target:"ecjx3jw3"})({name:"168giuu",styles:"display:initial"}),Bt=(0,i.Z)(pt.Z,{target:"ecjx3jw2"})({name:"1p0lxza",styles:">div{display:inline;}"}),Lt=(0,i.Z)(S.bv,{target:"ecjx3jw1"})({name:"1989ovb",styles:"vertical-align:middle"}),It=(0,i.Z)("div",{target:"ecjx3jw0"})("position:absolute;left:-1px;margin-top:4.5px;width:9px;height:15px;border-radius:0 3px 3px 0;background-color:",(e=>e.theme.charts.getColorPalette(e.count-2)[e.index]),";"),Ot=(0,Me.Z)(Et);class Ft extends o.PureComponent{constructor(...e){super(...e),(0,s.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,pageLinks:null,tableData:null}),(0,s.Z)(this,"shouldRefetchData",(e=>{const t=this.props.eventView.getEventsAPIPayload(this.props.location),n=e.eventView.getEventsAPIPayload(e.location);return!(0,j.ze)(t,n)})),(0,s.Z)(this,"fetchData",(()=>{const{eventView:e,organization:t,location:n,setError:s,confirmedQuery:i}=this.props;if(!e.isValid()||!i)return;const o="/organizations/".concat(t.slug,"/eventsv2/"),a=Symbol("tableFetchID"),r=e.getEventsAPIPayload(n);r.referrer="api.discover.query-table",s("",200),this.setState({isLoading:!0,tableFetchID:a}),T.oF.mark({name:"discover-events-start-".concat(r.query)}),this.props.api.clear(),this.props.api.requestPromise(o,{method:"GET",includeAllArgs:!0,query:r}).then((([e,t,n])=>{T.oF.measure({name:"app.api.discover-query",start:"discover-events-start-".concat(r.query),data:{status:n&&n.status}}),this.state.tableFetchID===a&&this.setState((t=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:n?n.getResponseHeader("Link"):t.pageLinks,tableData:e})))})).catch((e=>{var t;T.oF.measure({name:"app.api.discover-query",start:"discover-events-start-".concat(r.query),data:{status:e.status}});const n=(null==e||null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||(0,P.t)("An unknown error occurred.");this.setState({isLoading:!1,tableFetchID:void 0,error:n,pageLinks:null,tableData:null}),(0,T.ec)({eventKey:"discover_search.failed",eventName:"Discover Search: Failed",organization_id:this.props.organization.id,search_type:"events",search_source:"discover_search",error:n}),s(n,e.status)}))}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){(!this.state.isLoading&&this.shouldRefetchData(e)||!1===e.eventView.isValid()&&this.props.eventView.isValid()||e.confirmedQuery!==this.props.confirmedQuery)&&this.fetchData()}render(){const{eventView:e,organization:t,tags:n}=this.props,{pageLinks:s,tableData:i,isLoading:o,error:a}=this.state,r=Object.values(n).map((({key:e})=>e)),l=!!s&&!1===(0,at.Z)(s).previous.results;return(0,le.BX)(Mt,{children:[(0,le.tZ)(ot.Z,{organization:t,children:({measurements:t})=>{const n=Object.values(t).map((({key:e})=>e));return(0,le.tZ)(Ot,{...this.props,isLoading:o,isFirstPage:l,error:a,eventView:e,tableData:i,tagKeys:r,measurementKeys:n,spanOperationBreakdownKeys:rt})}}),(0,le.tZ)(it.Z,{pageLinks:s})]})}}Ft.displayName="Table";const Rt=(0,B.Z)((0,lt.Z)(Ft)),Mt=(0,i.Z)("div",{target:"e1rpfy900"})({name:"ovk77c",styles:"min-width:0"});var Ut=n("./app/views/eventsV2/tags.tsx");const Wt="discover2:show-tags";function Kt(e,t,n){return e.query.yAxis?(0,N.qP)(e.query.yAxis):null!=n&&n.yAxis&&n.yAxis.length>0?(0,N.qP)(null==n?void 0:n.yAxis):[t.getYAxis()]}class Ht extends o.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{eventView:j.ZP.fromSavedQueryOrLocation(this.props.savedQuery,this.props.location),error:"",errorCode:200,totalValues:null,showTags:"1"===_.Z.getItem(Wt),needConfirmation:!1,confirmedQuery:!1,incompatibleAlertNotice:null}),(0,s.Z)(this,"tagsApi",new v.KU),(0,s.Z)(this,"canLoadEvents",(async()=>{const{api:e,location:t,organization:n}=this.props,{eventView:s}=this.state;let i=!1,o=!0;const a=s.getEventsAPIPayload(t);if(s.getDays()>30&&a.project){let t=a.project.length;if(0===t||1===t&&"-1"===a.project[0])try{const s=await(0,m.xV)(e,n.slug);t=0===t?s.myProjects:s.allProjects}catch(e){}t>10&&(i=!0,o=!1)}this.setState({needConfirmation:i,confirmedQuery:o},(()=>{this.setState({confirmedQuery:!1})})),i&&this.openConfirm()})),(0,s.Z)(this,"openConfirm",(()=>{})),(0,s.Z)(this,"setOpenFunction",(({open:e})=>(this.openConfirm=e,null))),(0,s.Z)(this,"handleConfirmed",(async()=>{this.setState({needConfirmation:!1,confirmedQuery:!0},(()=>{this.setState({confirmedQuery:!1})}))})),(0,s.Z)(this,"handleCancelled",(()=>{this.setState({needConfirmation:!1,confirmedQuery:!1})})),(0,s.Z)(this,"handleChangeShowTags",(()=>{const{organization:e}=this.props;(0,T.ec)({eventKey:"discover_v2.results.toggle_tag_facets",eventName:"Discoverv2: Toggle Tag Facets",organization_id:parseInt(e.id,10)}),this.setState((e=>{const t=!e.showTags;return _.Z.setItem(Wt,t?"1":"0"),{...e,showTags:t}}))})),(0,s.Z)(this,"handleSearch",(e=>{const{router:t,location:n}=this.props,s=(0,D.Q)({...n.query||{},query:e}),i=p()(s,"cursor");t.push({pathname:n.pathname,query:i})})),(0,s.Z)(this,"handleYAxisChange",(e=>{const{router:t,location:n}=this.props,s=E.px.includes(n.query.display),i={...n.query,yAxis:e,display:e.length>1&&!s?n.query.display===E.DC.DAILYTOP5?E.DC.DAILY:E.DC.DEFAULT:n.query.display};t.push({pathname:n.pathname,query:i}),this.state.needConfirmation||this.handleConfirmed(),(0,T.ec)({eventKey:"discover_v2.y_axis_change",eventName:"Discoverv2: Change chart's y axis",organization_id:parseInt(this.props.organization.id,10),y_axis_value:e})})),(0,s.Z)(this,"handleDisplayChange",(e=>{const{router:t,location:n}=this.props,s={...n.query,display:e};t.push({pathname:n.pathname,query:s}),this.state.needConfirmation||this.handleConfirmed()})),(0,s.Z)(this,"handleTopEventsChange",(e=>{const{router:t,location:n}=this.props,s={...n.query,topEvents:e};t.push({pathname:n.pathname,query:s}),this.state.needConfirmation||this.handleConfirmed()})),(0,s.Z)(this,"generateTagUrl",((e,t)=>{const{organization:n}=this.props,{eventView:s}=this.state,i=s.getResultsViewUrlTarget(n.slug);return i.query=(0,q.ZT)(i.query,{key:e,value:t}),i})),(0,s.Z)(this,"handleIncompatibleQuery",((e,t)=>{const{organization:n}=this.props,{eventView:s}=this.state;(0,T.ec)({eventKey:"discover_v2.create_alert_clicked",eventName:"Discoverv2: Create alert clicked",status:"error",query:s.query,errors:t,organization_id:n.id,url:window.location.href});const i=e((()=>this.setState({incompatibleAlertNotice:null})));this.setState({incompatibleAlertNotice:i})})),(0,s.Z)(this,"setError",((e,t)=>{this.setState({error:e,errorCode:t})}))}static getDerivedStateFromProps(e,t){if(e.savedQuery||!e.loading){const n=j.ZP.fromSavedQueryOrLocation(e.savedQuery,e.location);return{...t,eventView:n,savedQuery:e.savedQuery}}return t}componentDidMount(){const{organization:e,selection:t,location:n}=this.props;(0,g.QK)(this.tagsApi,e.slug,t),(0,O.n4)(t),this.checkEventView(),this.canLoadEvents(),(0,q.ri)(n.query.id)&&(0,u.EQ)(e.slug,n.query.id)}componentDidUpdate(e,t){const{api:n,location:s,organization:i,selection:o}=this.props,{eventView:a,confirmedQuery:r,savedQuery:l}=this.state;this.checkEventView();const c=a.getEventsAPIPayload(s),p=t.eventView.getEventsAPIPayload(e.location),u=Kt(s,a,l),h=Kt(e.location,t.eventView,t.savedQuery);(0,j.ze)(c,p)&&!this.hasChartParametersChanged(t.eventView,a,h,u)||(n.clear(),this.canLoadEvents()),d()(e.selection.datetime,o.datetime)&&d()(e.selection.projects,o.projects)||((0,g.QK)(this.tagsApi,i.slug,o),(0,O.n4)(o)),t.confirmedQuery!==r&&this.fetchTotalCount()}hasChartParametersChanged(e,t,n,s){return!d()(n,s)||e.getDisplayMode()!==t.getDisplayMode()}async fetchTotalCount(){const{api:e,organization:t,location:n}=this.props,{eventView:s,confirmedQuery:i}=this.state;if(!1!==i&&s.isValid())try{const i=await(0,h.JE)(e,t.slug,s.getEventsAPIPayload(n));this.setState({totalValues:i})}catch(e){r.Tb(e)}}checkEventView(){var e;const{eventView:t}=this.state,{loading:n}=this.props;if(t.isValid()||n)return;const{location:s,organization:i,selection:o}=this.props,r=j.ZP.fromNewQueryWithLocation(F.eP,s);0===r.project.length&&o.projects&&(r.project=o.projects),null!==(e=s.query)&&void 0!==e&&e.query&&(r.query=(0,N.ro)(s.query.query,"")),a.browserHistory.replace(r.getResultsViewUrlTarget(i.slug))}getDocumentTitle(){const{organization:e}=this.props,{eventView:t}=this.state;return t?(0,vt.zt)({eventView:t,organization:e}):""}renderTagsTable(){const{organization:e,location:t}=this.props,{eventView:n,totalValues:s,confirmedQuery:i}=this.state;return(0,le.tZ)(f.MF,{children:(0,le.tZ)(Ut.Z,{generateUrl:this.generateTagUrl,totalValues:s,eventView:n,organization:e,location:t,confirmedQuery:i})})}renderError(e){return e?(0,le.tZ)(y.Z,{type:"error",icon:(0,le.tZ)(S.Gy,{size:"md"}),children:e}):null}render(){const{organization:e,location:t,router:n}=this.props,{eventView:s,error:i,errorCode:o,totalValues:a,showTags:r,incompatibleAlertNotice:l,confirmedQuery:d,savedQuery:c}=this.state,p=s.hasAggregateField()?(0,Q.db)(e,s.fields):s.fields,u=s.query,h=this.getDocumentTitle(),m=Kt(t,s,c);return(0,le.tZ)(A.Z,{title:h,orgSlug:e.slug,children:(0,le.tZ)(Xt,{children:(0,le.BX)(b.Z,{organization:e,children:[(0,le.tZ)(st,{errorCode:o,organization:e,location:t,eventView:s,onIncompatibleAlertQuery:this.handleIncompatibleQuery,yAxis:m}),(0,le.BX)(f.uT,{children:[l&&(0,le.tZ)(Gt,{fullWidth:!0,children:l}),(0,le.BX)(Gt,{fullWidth:!0,children:[this.renderError(i),(0,le.tZ)(Yt,{searchSource:"eventsv2",organization:e,projectIds:s.project,query:u,fields:p,onSearch:this.handleSearch,maxQueryLength:z.dI}),(0,le.tZ)(fe,{router:n,organization:e,eventView:s,location:t,onAxisChange:this.handleYAxisChange,onDisplayChange:this.handleDisplayChange,onTopEventsChange:this.handleTopEventsChange,total:a,confirmedQuery:d,yAxis:m})]}),(0,le.tZ)(f.or,{fullWidth:!r,children:(0,le.tZ)(Rt,{organization:e,eventView:s,location:t,title:h,setError:this.setError,onChangeShowTags:this.handleChangeShowTags,showTags:r,confirmedQuery:d})}),r?this.renderTagsTable():null,(0,le.tZ)(x.Z,{priority:"primary",header:(0,le.tZ)("strong",{children:(0,P.t)("May lead to thumb twiddling")}),confirmText:(0,P.t)("Do it"),cancelText:(0,P.t)("Nevermind"),onConfirm:this.handleConfirmed,onCancel:this.handleCancelled,message:(0,le.tZ)("p",{children:(0,P._N)("You've created a query that will search for events made\n                      [dayLimit:over more than 30 days] for [projectLimit:more than 10 projects].\n                      A lot has happened during that time, so this might take awhile.\n                      Are you sure you want to do this?",{dayLimit:(0,le.tZ)("strong",{}),projectLimit:(0,le.tZ)("strong",{})})}),children:this.setOpenFunction})]})]})})})}}Ht.displayName="Results";const Xt=(0,i.Z)(V.JH,{target:"e1phmre32"})({name:"1hcx8jb",styles:"padding:0"}),Yt=(0,i.Z)(w.Z,{target:"e1phmre31"})("margin-bottom:",(0,k.Z)(2),";"),Gt=(0,i.Z)(f.or,{target:"e1phmre30"})({name:"y6n6nb",styles:"flex-grow:0"});class Jt extends Z.Z{getEndpoints(){const{organization:e,location:t}=this.props;return t.query.id?[["savedQuery","/organizations/".concat(e.slug,"/discover/saved/").concat(t.query.id,"/")]]:[]}renderLoading(){return this.renderBody()}renderBody(){const{savedQuery:e,loading:t}=this.state;return(0,le.tZ)(Ht,{...this.props,savedQuery:null!=e?e:void 0,loading:t})}}function $t(e){return(0,le.tZ)(C.Z,{skipLoadLastUsed:e.organization.features.includes("global-views"),children:(0,le.tZ)(Jt,{...e})})}$t.displayName="ResultsContainer";const en=(0,B.Z)((0,I.Z)((0,L.Z)($t)))},"./app/views/eventsV2/tags.tsx":(e,t,n)=>{n.d(t,{Z:()=>D});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),a=n("../node_modules/@sentry/minimal/esm/index.js"),r=n("./app/actionCreators/events.tsx"),l=n("./app/components/charts/errorPanel.tsx"),d=n("./app/components/charts/styles.tsx"),c=n("./app/components/emptyStateWarning.tsx"),p=n("./app/components/placeholder.tsx"),u=n("./app/components/tagDistributionMeter.tsx"),h=n("./app/icons/index.tsx"),m=n("./app/locale.tsx"),g=n("./app/styles/space.tsx"),v=n("./app/utils/analytics.tsx"),y=n("./app/utils/discover/eventView.tsx"),Z=n("./app/utils/withApi.tsx"),x=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class w extends o.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{loading:!0,tags:[],totalValues:null,error:""}),(0,s.Z)(this,"shouldRefetchData",(e=>{const t=this.props.eventView.getFacetsAPIPayload(this.props.location),n=e.eventView.getFacetsAPIPayload(e.location);return!(0,y.ze)(t,n)})),(0,s.Z)(this,"fetchData",(async(e=!1)=>{const{api:t,organization:n,eventView:s,location:i,confirmedQuery:o}=this.props;if(this.setState({loading:!0,error:"",tags:[]}),e||!1!==o)try{const e=await(0,r.eV)(t,n.slug,s.getFacetsAPIPayload(i));this.setState({loading:!1,tags:e})}catch(e){a.Tb(e),this.setState({loading:!1,error:e})}})),(0,s.Z)(this,"handleTagClick",(e=>{const{organization:t}=this.props;(0,v.ec)({eventKey:"discover_v2.facet_map.clicked",eventName:"Discoverv2: Clicked on a tag on the facet map",tag:e,organization_id:parseInt(t.id,10)})})),(0,s.Z)(this,"renderBody",(()=>{const{loading:e,error:t,tags:n}=this.state;return e?this.renderPlaceholders():t?(0,x.tZ)(l.Z,{height:"132px",children:(0,x.tZ)(h.FC,{color:"gray300",size:"lg"})}):n.length>0?n.map((e=>this.renderTag(e))):(0,x.tZ)(f,{small:!0,children:(0,m.t)("No tags found")})}))}componentDidMount(){this.fetchData(!0)}componentDidUpdate(e){(this.shouldRefetchData(e)||e.confirmedQuery!==this.props.confirmedQuery)&&this.fetchData()}renderTag(e){const{generateUrl:t,totalValues:n}=this.props,s=e.topValues.map((n=>(n.url=t(e.key,n.value),n))),i=s.length>0?Math.max(Number(n),s[0].count):n;return(0,x.tZ)(u.Z,{title:e.key,segments:s,totalValues:Number(i),renderLoading:()=>(0,x.tZ)(b,{height:"16px"}),onTagClick:this.handleTagClick,showReleasePackage:!0},e.key)}renderPlaceholders(){return(0,x.BX)(o.Fragment,{children:[(0,x.tZ)(C,{},"title-1"),(0,x.tZ)(b,{},"bar-1"),(0,x.tZ)(C,{},"title-2"),(0,x.tZ)(b,{},"bar-2"),(0,x.tZ)(C,{},"title-3"),(0,x.tZ)(b,{},"bar-3")]})}render(){return(0,x.BX)(o.Fragment,{children:[(0,x.tZ)(d.OT,{children:(0,m.t)("Tag Summary")}),this.renderBody()]})}}w.displayName="Tags";const f=(0,i.Z)(c.Z,{target:"e1pu9veq2"})({name:"rtpdsm",styles:"height:132px;padding:54px 15%"}),b=(0,i.Z)(p.Z,{target:"e1pu9veq1"})("border-radius:",(e=>e.theme.borderRadius),";height:16px;margin-bottom:",(0,g.Z)(1.5),";"),C=(0,i.Z)(p.Z,{target:"e1pu9veq0"})("width:100px;height:12px;margin-bottom:",(0,g.Z)(.5),";"),D=(0,Z.Z)(w)}}]);
//# sourceMappingURL=../sourcemaps/app_views_eventsV2_results_tsx.d89a5d5fb9fb6a0ca3d9912228d2604f.js.map