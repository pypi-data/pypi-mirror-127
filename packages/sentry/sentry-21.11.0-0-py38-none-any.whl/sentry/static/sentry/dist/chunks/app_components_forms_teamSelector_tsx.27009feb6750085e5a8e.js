"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_components_forms_teamSelector_tsx"],{"./app/actionCreators/teams.tsx":(e,t,s)=>{s.d(t,{PX:()=>l,eM:()=>u,z_:()=>d,fs:()=>m,um:()=>p,s:()=>g,Cm:()=>h,tT:()=>f}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("./app/actionCreators/indicator.tsx"),a=s("./app/actions/teamActions.tsx"),r=s("./app/locale.tsx"),n=s("./app/utils/callIfFunction.tsx");if("app"==s.j)var i=s("./app/utils/guid.tsx");const c=(e={},t,...s)=>{(0,n.g)(e[t],...s)};async function l(e,t){const s=await e.requestPromise("/organizations/".concat(t.orgId,"/user-teams/"));a.Z.loadUserTeams(s)}function u(e,t,s){return a.Z.fetchDetails(t.teamId),e.request("/teams/".concat(t.orgId,"/").concat(t.teamId,"/"),{success:e=>{a.Z.fetchDetailsSuccess(t.teamId,e),c(s,"success",e)},error:e=>{a.Z.fetchDetailsError(t.teamId,e),c(s,"error",e)}})}function d(e,t){a.Z.updateSuccess(e,t)}function m(e,t,s){const o="/teams/".concat(t.orgId,"/").concat(t.teamId,"/");return a.Z.update(t.teamId,t.data),e.request(o,{method:"PUT",data:t.data,success:e=>{d(t.teamId,e),c(s,"success",e)},error:e=>{a.Z.updateError(t.teamId,e),c(s,"error",e)}})}function p(e,t,s){var o;const r="/organizations/".concat(t.orgId,"/members/").concat(null!==(o=t.memberId)&&void 0!==o?o:"me","/teams/").concat(t.teamId,"/"),n=(0,i.E)();return a.Z.update(n,t.teamId),e.request(r,{method:"POST",success:e=>{a.Z.updateSuccess(t.teamId,e),c(s,"success",e)},error:e=>{a.Z.updateError(n,t.teamId,e),c(s,"error",e)}})}function g(e,t,s){const o="/organizations/".concat(t.orgId,"/members/").concat(t.memberId||"me","/teams/").concat(t.teamId,"/"),r=(0,i.E)();return a.Z.update(r,t.teamId),e.request(o,{method:"DELETE",success:e=>{a.Z.updateSuccess(t.teamId,e),c(s,"success",e)},error:e=>{a.Z.updateError(r,t.teamId,e),c(s,"error",e)}})}function h(e,t,s){return a.Z.createTeam(t),e.requestPromise("/organizations/".concat(s.orgId,"/teams/"),{method:"POST",data:t}).then((e=>(a.Z.createTeamSuccess(e),(0,o.S9)((0,r._N)("[team] has been added to the [organization] organization",{team:"#".concat(e.slug),organization:s.orgId})),e)),(e=>{throw a.Z.createTeamError(t.slug,e),(0,o.Iw)((0,r._N)("Unable to create [team] in the [organization] organization",{team:"#".concat(t.slug),organization:s.orgId})),e}))}function f(e,t){return a.Z.removeTeam(t.teamId),e.requestPromise("/teams/".concat(t.orgId,"/").concat(t.teamId,"/"),{method:"DELETE"}).then((e=>(a.Z.removeTeamSuccess(t.teamId,e),(0,o.S9)((0,r._N)("[team] has been removed from the [organization] organization",{team:"#".concat(t.teamId),organization:t.orgId})),e)),(e=>{throw a.Z.removeTeamError(t.teamId,e),(0,o.Iw)((0,r._N)("Unable to remove [team] from the [organization] organization",{team:"#".concat(t.teamId),organization:t.orgId})),e}))}},"./app/components/forms/teamSelector.tsx":(e,t,s)=>{s.d(t,{Z:()=>_});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),r=s("../node_modules/lodash/debounce.js"),n=s.n(r),i=s("./app/actionCreators/projects.tsx"),c=s("./app/components/button.tsx"),l=s("./app/components/forms/selectControl.tsx"),u=s("./app/components/idBadge/index.tsx"),d=s("./app/components/tooltip.tsx"),m=s("./app/constants/index.tsx"),p=s("./app/icons/index.tsx"),g=s("./app/locale.tsx"),h=s("./app/styles/space.tsx"),f=s("./app/utils/useApi.tsx"),x=s("./app/utils/useTeams.tsx"),Z=s("./app/utils/withOrganization.tsx"),v=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const y=(0,o.Z)("div",{target:"e1bme5454"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),b=(0,o.Z)(p.qO,{target:"e1bme5453"})("margin-left:",(0,h.Z)(.25),";margin-right:",(0,h.Z)(1),";color:",(e=>e.theme.gray400),";"),I={value:null,label:(0,v.BX)(y,{children:[(0,v.tZ)(b,{size:"20px"}),(0,g.t)("Unassigned")]}),searchKey:"unassigned",actor:null,disabled:!1},S={option:(e,t)=>({...e,svg:{color:t.isSelected&&t.theme.white}})},z={input:(e,t)=>({...e,display:"grid",gridTemplateColumns:"max-content 1fr",alignItems:"center",gridGap:(0,h.Z)(1),":before":{backgroundColor:t.theme.backgroundSecondary,height:24,width:24,borderRadius:3,content:'""',display:"block"}}),placeholder:e=>({...e,paddingLeft:32})};function j(e){const{includeUnassigned:t,styles:s,...o}=e,{teamFilter:r,organization:c,project:h,multiple:Z,value:y,useId:b,onChange:j}=e,_=(0,f.Z)(),{teams:E,fetching:k,onSearch:q}=(0,x.Z)(),L=(0,a.useRef)(null),M=e=>({value:b?e.id:e.slug,label:Z?"#".concat(e.slug):(0,v.tZ)(u.Z,{team:e}),searchKey:e.slug,actor:{type:"team",id:e.id,name:e.slug}});function P(){if(!L.current)return;const e=L.current.select.inputRef;e&&e.blur()}function A(e){if(y===(b?e.id:e.slug))return M(e);const t=c.access.includes("project:write");return{...M(e),disabled:!0,label:(0,v.BX)(w,{children:[(0,v.tZ)(C,{children:(0,v.tZ)(d.Z,{position:"left",title:(0,g.t)("%s is not a member of project","#".concat(e.slug)),children:(0,v.tZ)(u.Z,{team:e})})}),(0,v.tZ)(d.Z,{title:t?(0,g.t)("Add %s to project","#".concat(e.slug)):(0,g.t)("You do not have permission to add team to project."),children:(0,v.tZ)(T,{type:"button",size:"zero",borderless:!0,disabled:!t,onClick:()=>async function(e){if(!h)return void P();const t=Z?[...null!=y?y:[]]:{value:y};null==j||j(M(e));try{await(0,i.Oe)(_,c.slug,h.slug,e)}catch(e){null==j||j(t)}P()}(e),icon:(0,v.tZ)(p.N_,{isCircled:!0})})})]})}}return(0,v.tZ)(l.Z,{ref:L,options:function(){const e=r?E.filter(r):E;if(h){const s=new Set(h.teams.map((e=>e.id))),o=e.filter((e=>s.has(e.id))),a=e.filter((e=>!s.has(e.id)));return[...o.map(M),...a.map(A),...t?[I]:[]]}return[...e.map(M),...t?[I]:[]]}(),onInputChange:n()((e=>{q(e)}),m.Dk),isOptionDisabled:e=>!!e.disabled,getOptionValue:e=>e.searchKey,styles:{...t?S:{},...Z?{}:z,...null!=s?s:{}},isLoading:k,...o})}j.displayName="TeamSelector";const w=(0,o.Z)("div",{target:"e1bme5452"})({name:"1laz9o6",styles:"display:flex;justify-content:space-between;align-items:flex-end"}),C=(0,o.Z)("div",{target:"e1bme5451"})({name:"v6ye5b",styles:"display:flex;opacity:0.5;overflow:hidden"}),T=(0,o.Z)(c.ZP,{target:"e1bme5450"})({name:"ozd7xs",styles:"flex-shrink:0"}),_=(0,Z.Z)(j)},"./app/utils/isActiveSuperuser.tsx":(e,t,s)=>{s.d(t,{M:()=>n});var o=s("../node_modules/js-cookie/src/js.cookie.js"),a=s.n(o),r=s("./app/stores/configStore.tsx");function n(){const{isSuperuser:e}=r.Z.get("user")||{};return!(!e||(a().set("su","test"),void 0!==a().get("su")))}},"./app/utils/useTeams.tsx":(e,t,s)=>{s.d(t,{Z:()=>h}),s("../node_modules/core-js/modules/es.string.trim.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/react/index.js"),a=s("../node_modules/lodash/uniqBy.js"),r=s.n(a),n=s("./app/actionCreators/teams.tsx"),i=s("./app/actions/teamActions.tsx"),c=s("./app/stores/organizationStore.tsx"),l=s("./app/stores/teamStore.tsx"),u=s("./app/stores/useLegacyStore.tsx"),d=s("./app/utils/isActiveSuperuser.tsx"),m=s("./app/utils/parseLinkHeader.tsx"),p=s("./app/utils/useApi.tsx");async function g(e,t,{slugs:s,search:o,limit:a,lastSearch:r,cursor:n}={}){const i={};var c;void 0!==s&&s.length>0&&(i.query=s.map((e=>"slug:".concat(e))).join(" ")),o&&(i.query="".concat(null!==(c=i.query)&&void 0!==c?c:""," ").concat(o).trim()),(r===o||!r&&!o)&&n&&(i.cursor=n),void 0!==a&&(i.per_page=a);let l=!1,u=null;const[d,,p]=await e.requestPromise("/organizations/".concat(t,"/teams/"),{includeAllArgs:!0,query:i}),g=null==p?void 0:p.getResponseHeader("Link");if(g){var h,f,x;const e=(0,m.Z)(g);l=(null==e||null===(h=e.next)||void 0===h?void 0:h.results)||(null==e||null===(f=e.previous)||void 0===f?void 0:f.results),u=null==e||null===(x=e.next)||void 0===x?void 0:x.cursor}return{results:d,hasMore:l,nextCursor:u}}const h=function({limit:e,slugs:t,provideUserTeams:s}={}){var a;const m=(0,p.Z)(),{organization:h}=(0,u.X)(c.Z),f=(0,u.X)(l.Z),x=null==h?void 0:h.slug,Z=new Set(f.teams.map((e=>e.slug))),v=null!==(a=null==t?void 0:t.filter((e=>!Z.has(e))))&&void 0!==a?a:[],y=v.length>0,b=s&&!f.loadedUserTeams,I=!y&&!b,[S,z]=(0,o.useState)({initiallyLoaded:I,fetching:!1,hasMore:null,lastSearch:null,nextCursor:null,fetchError:null}),j=(0,o.useRef)(null);void 0!==t&&(null===j.current&&(j.current=new Set(t)),(t.length!==j.current.size||t.some((e=>{var t;return!(null!==(t=j.current)&&void 0!==t&&t.has(e))})))&&(j.current=new Set(t))),(0,o.useEffect)((()=>{y?async function(){if(void 0!==x){z({...S,fetching:!0});try{const{results:t,hasMore:s,nextCursor:o}=await g(m,x,{slugs:v,limit:e}),a=r()([...f.teams,...t],(({slug:e})=>e));i.Z.loadTeams(a),z({...S,hasMore:s,fetching:!1,initiallyLoaded:!0,nextCursor:o})}catch(e){console.error(e),z({...S,fetching:!1,initiallyLoaded:!0,fetchError:e})}}}():b&&async function(){if(void 0!==x){z({...S,fetching:!0});try{await(0,n.PX)(m,{orgId:x}),z({...S,fetching:!1,initiallyLoaded:!0})}catch(e){console.error(e),z({...S,fetching:!1,initiallyLoaded:!0,fetchError:e})}}}()}),[j.current,s]);const w=(0,d.M)();return{teams:t?f.teams.filter((e=>t.includes(e.slug))):s&&!w?f.teams.filter((e=>e.isMember)):f.teams,fetching:S.fetching||f.loading,initiallyLoaded:S.initiallyLoaded,fetchError:S.fetchError,hasMore:S.hasMore,onSearch:async function(t){const{lastSearch:s}=S,o=S.nextCursor;if(""!==t)if(void 0!==x){z({...S,fetching:!0});try{m.clear();const{results:a,hasMore:n,nextCursor:c}=await g(m,x,{search:t,limit:e,lastSearch:s,cursor:o}),l=r()([...f.teams,...a],(({slug:e})=>e));l.length>f.teams.length&&i.Z.loadTeams(l),z({...S,hasMore:n,fetching:!1,lastSearch:t,nextCursor:c})}catch(e){console.error(e),z({...S,fetching:!1,fetchError:e})}}else console.error("Cannot use useTeam.onSearch without an organization in context")}}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_forms_teamSelector_tsx.d6b83f90710f70744c7fe05fdb0e2cef.js.map