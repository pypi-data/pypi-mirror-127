"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_alerts_rules_index_tsx"],{"./app/utils/teams.tsx":(e,t,a)=>{a.d(t,{Z:()=>o});var s=a("../node_modules/react/index.js"),n=a("./app/utils/useTeams.tsx"),i=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r({children:e,...t}){const a=(0,n.Z)(t);return(0,i.tZ)(s.Fragment,{children:e(a)})}r.displayName="Teams";const o=r},"./app/views/alerts/alertBadge.tsx":(e,t,a)=>{a.d(t,{Z:()=>c});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=a("./app/icons/index.tsx"),i=a("./app/locale.tsx"),r=a("./app/styles/space.tsx"),o=a("./app/views/alerts/types.tsx"),l=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d({status:e,hideText:t=!1,isIssue:a}){let s=(0,i.t)("Resolved"),r=n.DL,d="green300";return a?(s=(0,i.t)("Issue"),r=n.XI,d="gray300"):e===o.vt.CRITICAL?(s=(0,i.t)("Critical"),r=n.zC,d="red300"):e===o.vt.WARNING&&(s=(0,i.t)("Warning"),r=n.FC,d="yellow300"),(0,l.BX)(p,{"data-test-id":"alert-badge",displayFlex:!t,children:[(0,l.tZ)(u,{color:d,icon:r,children:(0,l.tZ)(r,{color:"white"})}),!t&&(0,l.tZ)(m,{color:d,children:s})]})}d.displayName="AlertBadge";const c=d,p=(0,s.Z)("div",{target:"e1ov36c52"})("display:",(e=>e.displayFlex?"flex":"block"),";align-items:center;"),u=(0,s.Z)("div",{target:"e1ov36c51"})("display:flex;align-items:center;justify-content:center;flex-shrink:0;line-height:",(e=>e.icon===n.FC?void 0:1),";left:3px;min-width:30px;&:before{content:'';position:absolute;width:22px;height:22px;border-radius:",(e=>e.theme.borderRadius),";background-color:",(e=>e.theme[e.color]),";transform:rotate(45deg);}svg{width:",(e=>e.icon===n.XI?"11px":"13px"),";z-index:1;}"),m=(0,s.Z)("div",{target:"e1ov36c50"})("margin-left:",(0,r.Z)(1),";color:",(e=>e.theme[e.color]),";")},"./app/views/alerts/rules/index.tsx":(e,t,a)=>{a.r(t),a.d(t,{default:()=>pe});var s=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/react/index.js")),r=a("../node_modules/lodash/flatten.js"),o=a.n(r),l=a("./app/actionCreators/indicator.tsx"),d=a("./app/components/asyncComponent.tsx"),c=a("./app/components/layouts/thirds.tsx"),p=a("./app/components/links/externalLink.tsx"),u=a("./app/components/links/link.tsx"),m=a("./app/components/organizations/globalSelectionHeader/index.tsx"),h=a("./app/components/pagination.tsx"),g=a("./app/components/panels/index.tsx"),Z=a("./app/components/searchBar.tsx"),x=a("./app/components/sentryDocumentTitle.tsx"),v=a("./app/icons/index.tsx"),y=a("./app/locale.tsx"),f=a("./app/styles/space.tsx"),w=a("./app/utils/analytics.tsx"),b=a("./app/utils/projects.tsx"),I=a("./app/utils/teams.tsx"),C=a("./app/utils/withGlobalSelection.tsx"),q=a("./app/views/alerts/list/header.tsx"),A=a("./app/views/alerts/utils/index.tsx"),B=a("../node_modules/lodash/memoize.js"),j=a.n(B),L=a("./app/components/acl/access.tsx"),_=a("./app/components/actions/menuItemActionLink.tsx"),T=a("./app/components/avatar/actorAvatar.tsx"),z=a("./app/components/button.tsx"),k=a("./app/components/buttonBar.tsx"),R=a("./app/components/confirm.tsx"),D=a("./app/components/dateTime.tsx"),S=a("./app/components/dropdownLink.tsx"),E=a("./app/components/errorBoundary.tsx"),X=a("./app/components/idBadge/index.tsx"),N=a("./app/components/timeSince.tsx"),G=a("./app/components/tooltip.tsx"),F=a("./app/styles/overflowEllipsis.tsx"),P=a("./app/utils/getDynamicText.tsx"),V=a("./app/views/alerts/incidentRules/types.tsx"),O=a("./app/views/alerts/alertBadge.tsx"),W=a("./app/views/alerts/types.tsx"),M=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Y=j()(((e,t)=>t.find((t=>t.slug===e))));function K({rule:e,projectsLoaded:t,projects:a,orgId:s,onDelete:n,userTeams:r}){var o,l,d,c,p;const m=void 0!==(null===(o=e.latestIncident)||void 0===o?void 0:o.status)&&[W.vt.CRITICAL,W.vt.WARNING].includes(e.latestIncident.status),h=e.projects[0],g="/organizations/".concat(s,"/alerts/").concat((0,A.Gm)(e)?"rules":"metric-rules","/").concat(h,"/").concat(e.id,"/"),Z="/organizations/".concat(s,"/alerts/rules/details/").concat(e.id,"/"),x=null===(l=e.owner)||void 0===l?void 0:l.split(":")[1],f=x?{type:"team",id:x,name:""}:null,w=!x||r.has(x),b=(0,A.Gm)(e)?e.name:(0,M.tZ)(U,{to:(0,A.Gm)(e)?g:Z,children:e.name}),I={[W.vt.CRITICAL]:(0,y.t)("Critical"),[W.vt.WARNING]:(0,y.t)("Warning"),[W.vt.CLOSED]:(0,y.t)("Resolved"),[W.vt.OPENED]:(0,y.t)("Resolved")};return(0,M.BX)(E.Z,{children:[(0,M.BX)(J,{isIssueAlert:(0,A.Gm)(e),children:[(0,M.tZ)(H,{children:(0,M.tZ)(G.Z,{title:(0,A.Gm)(e)?(0,y.t)("Issue Alert"):(0,y._N)("Metric Alert Status: [status]",{status:I[null!==(d=null==e||null===(c=e.latestIncident)||void 0===c?void 0:c.status)&&void 0!==d?d:W.vt.CLOSED]}),children:(0,M.tZ)(O.Z,{status:null==e||null===(p=e.latestIncident)||void 0===p?void 0:p.status,isIssue:(0,A.Gm)(e),hideText:!0})})}),(0,M.BX)(Q,{children:[(0,M.tZ)($,{children:b}),!(0,A.Gm)(e)&&((0,A.Gm)(e)?null:e.latestIncident?m?(0,M.BX)("div",{children:[(0,y.t)("Triggered "),(0,M.tZ)(N.Z,{date:e.latestIncident.dateCreated})]}):(0,M.BX)("div",{children:[(0,y.t)("Resolved "),(0,M.tZ)(N.Z,{date:e.latestIncident.dateClosed})]}):"-")]})]}),(0,M.tZ)(H,{children:function(){var t,a;if((0,A.Gm)(e))return null;const s=e.triggers.find((({label:e})=>"critical"===e)),n=e.triggers.find((({label:e})=>"warning"===e)),i=e.resolveThreshold,r=m&&(null===(t=e.latestIncident)||void 0===t?void 0:t.status)===W.vt.CRITICAL?s:null!=n?n:s;let o,l="green300",d=m&&e.thresholdType===V.lT.ABOVE?(0,y.t)("Above"):(0,y.t)("Below");return m?(l="critical"===(null==r?void 0:r.label)?"red300":"warning"===(null==r?void 0:r.label)?"yellow300":"green300",o=e.thresholdType===V.lT.ABOVE?"up":"down"):(o=e.thresholdType===V.lT.ABOVE?"down":"up",d=e.thresholdType===V.lT.ABOVE?(0,y.t)("Below"):(0,y.t)("Above")),(0,M.BX)(H,{children:[(0,M.tZ)(v.CC,{color:l,direction:o}),(0,M.tZ)(se,{children:"".concat(d," ").concat(e.latestIncident||!e.latestIncident&&!i?null==r||null===(a=r.alertThreshold)||void 0===a?void 0:a.toLocaleString():null==i?void 0:i.toLocaleString())})]})}()}),(0,M.tZ)(H,{children:(0,M.tZ)(ee,{children:(0,M.tZ)(te,{avatarSize:18,project:t?Y(h,a):{slug:h}})})}),(0,M.tZ)(H,{children:f?(0,M.tZ)(T.Z,{actor:f,size:24}):"-"}),(0,M.tZ)(H,{children:(0,M.tZ)(ae,{date:(0,P.Z)({value:e.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),(0,M.tZ)(re,{children:(0,M.tZ)(L.Z,{access:["alerts:write"],children:({hasAccess:t})=>(0,M.BX)(i.Fragment,{children:[(0,M.tZ)(ie,{children:(0,M.BX)(S.Z,{anchorRight:!0,caret:!1,title:(0,M.tZ)(z.ZP,{tooltipProps:{containerDisplayMode:"flex"},size:"small",type:"button","aria-label":(0,y.t)("Show more"),icon:(0,M.tZ)(v.YR,{size:"xs"})}),children:[(0,M.tZ)("li",{children:(0,M.tZ)(u.Z,{to:g,children:(0,y.t)("Edit")})}),(0,M.tZ)(R.Z,{disabled:!t||!w,message:(0,y._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:e.name}),header:(0,y.t)("Delete Alert Rule?"),priority:"danger",confirmText:(0,y.t)("Delete Rule"),onConfirm:()=>n(h,e),children:(0,M.tZ)(_.Z,{title:(0,y.t)("Delete"),children:(0,y.t)("Delete")})})]})}),(0,M.BX)(ne,{gap:1,children:[(0,M.tZ)(R.Z,{disabled:!t||!w,message:(0,y._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:e.name}),header:(0,y.t)("Delete Alert Rule?"),priority:"danger",confirmText:(0,y.t)("Delete Rule"),onConfirm:()=>n(h,e),children:(0,M.tZ)(z.ZP,{type:"button",icon:(0,M.tZ)(v.Fz,{}),size:"small",title:(0,y.t)("Delete")})}),(0,M.tZ)(G.Z,{title:(0,y.t)("Edit"),children:(0,M.tZ)(z.ZP,{size:"small",type:"button",icon:(0,M.tZ)(v.iC,{}),to:g})})]})]})})})]})}K.displayName="RuleListRow";const U=(0,n.Z)(u.Z,{target:"e1f6xqs311"})(F.Z,";"),H=(0,n.Z)("div",{target:"e1f6xqs310"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),J=(0,n.Z)(H,{target:"e1f6xqs39"})((e=>e.isIssueAlert&&"padding: ".concat((0,f.Z)(3)," ").concat((0,f.Z)(2),"; line-height: 2.4;")),";"),Q=(0,n.Z)("div",{target:"e1f6xqs38"})(F.Z," margin-left:",(0,f.Z)(1.5),";line-height:1.35;"),$=(0,n.Z)("div",{target:"e1f6xqs37"})(F.Z," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints[2]),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints[1]),"){max-width:100px;}"),ee=(0,n.Z)("div",{target:"e1f6xqs36"})({name:"1d3w5wq",styles:"width:100%"}),te=(0,n.Z)(X.Z,{target:"e1f6xqs35"})({name:"ozd7xs",styles:"flex-shrink:0"}),ae=(0,n.Z)(D.Z,{target:"e1f6xqs34"})({name:"kow0uz",styles:"font-variant-numeric:tabular-nums"}),se=(0,n.Z)("div",{target:"e1f6xqs33"})("margin-left:",(0,f.Z)(1),";white-space:nowrap;font-variant-numeric:tabular-nums;"),ne=(0,n.Z)(k.ZP,{target:"e1f6xqs32"})("display:none;justify-content:flex-start;align-items:center;@media (max-width: ",(e=>e.theme.breakpoints[1]),"){display:flex;}"),ie=(0,n.Z)("div",{target:"e1f6xqs31"})("display:none;@media (min-width: ",(e=>e.theme.breakpoints[1]),"){display:block;}"),re=(0,n.Z)(H,{target:"e1f6xqs30"})("justify-content:center;padding:",(0,f.Z)(1),";"),oe=K;var le=a("./app/views/alerts/rules/teamFilter.tsx");class de extends d.Z{constructor(...e){super(...e),(0,s.Z)(this,"handleChangeFilter",((e,t)=>{const{router:a,location:s}=this.props,{cursor:n,page:i,...r}=s.query,o=[...t];a.push({pathname:s.pathname,query:{...r,team:o.length?o:""}})})),(0,s.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:a}=this.props,{cursor:s,page:n,...i}=a.query;t.push({pathname:a.pathname,query:{...i,name:e}})})),(0,s.Z)(this,"handleDeleteRule",(async(e,t)=>{const{params:a}=this.props,{orgId:s}=a,n=(0,A.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise("/projects/".concat(s,"/").concat(e,"/").concat(n,"/").concat(t.id,"/"),{method:"DELETE"}),this.reloadData()}catch(e){(0,l.Iw)((0,y.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t}=this.props,{query:a}=t;return a.expand=["latestIncident"],a.team=(0,le.L)(a.team),a.sort||(a.sort=["incident_status","date_triggered"]),[["ruleList","/organizations/".concat(e&&e.orgId,"/combined-rules/"),{query:a}]]}renderLoading(){return this.renderBody()}renderFilterBar(){var e;const{location:t}=this.props,a=new Set((0,le.L)(t.query.team));return(0,M.BX)(he,{children:[(0,M.tZ)(le.Z,{selectedTeams:a,handleChangeFilter:this.handleChangeFilter}),(0,M.tZ)(ge,{placeholder:(0,y.t)("Search by name"),query:null===(e=t.query)||void 0===e?void 0:e.name,onSearch:this.handleChangeSearch})]})}renderList(){const{params:{orgId:e},location:{query:t},organization:a,router:s}=this.props,{loading:n,ruleList:i=[],ruleListPageLinks:r}=this.state,l=new Set(o()(null==i?void 0:i.map((({projects:e})=>e)))),d={asc:"1"===t.asc,field:t.sort||"date_added"},{cursor:u,page:m,...g}=t,Z=d.field.includes("incident_status")||d.field.includes("date_triggered"),x=(0,M.tZ)(v.CC,{color:"gray300",size:"xs",direction:d.asc?"up":"down"});return(0,M.tZ)(ue,{children:(0,M.BX)(c.or,{fullWidth:!0,children:[this.renderFilterBar(),(0,M.tZ)(I.Z,{provideUserTeams:!0,children:({initiallyLoaded:t,teams:s})=>(0,M.tZ)(Ze,{headers:[(0,M.BX)(me,{role:"columnheader","aria-sort":"name"!==d.field?"none":d.asc?"ascending":"descending",to:{pathname:location.pathname,query:{...g,asc:"name"===d.field&&d.asc?void 0:"1",sort:"name"}},children:[(0,y.t)("Alert Rule")," ","name"===d.field&&x]},"name"),(0,M.BX)(me,{role:"columnheader","aria-sort":Z?d.asc?"ascending":"descending":"none",to:{pathname:location.pathname,query:{...g,asc:Z&&!d.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,y.t)("Status")," ",Z&&x]},"status"),(0,y.t)("Project"),(0,y.t)("Team"),(0,M.BX)(me,{role:"columnheader","aria-sort":"date_added"!==d.field?"none":d.asc?"ascending":"descending",to:{pathname:location.pathname,query:{...g,asc:"date_added"!==d.field||d.asc?void 0:"1",sort:"date_added"}},children:[(0,y.t)("Created")," ","date_added"===d.field&&x]},"dateAdded"),(0,y.t)("Actions")],isLoading:n||!t,isEmpty:0===(null==i?void 0:i.length),emptyMessage:(0,y.t)("No alert rules found for the current query."),emptyAction:(0,M.tZ)(xe,{children:(0,y._N)("Learn more about [link:Alerts]",{link:(0,M.tZ)(p.Z,{href:"https://docs.sentry.io/product/alerts-notifications/metric-alerts/"})})}),children:(0,M.tZ)(b.Z,{orgId:e,slugs:Array.from(l),children:({initiallyLoaded:t,projects:n})=>i.map((i=>(0,M.tZ)(oe,{projectsLoaded:t,projects:n,rule:i,orgId:e,onDelete:this.handleDeleteRule,organization:a,userTeams:new Set(s.map((e=>e.id)))},"".concat((0,A.Gm)(i)?"metric":"issue","-").concat(i.id))))})})}),(0,M.tZ)(h.Z,{pageLinks:r,onCursor:(e,t,a)=>{let n=g.team;n&&0!==n.length||(n=""),s.push({pathname:t,query:{...g,team:n,cursor:e}})}})]})})}renderBody(){const{params:e,organization:t,router:a}=this.props,{orgId:s}=e;return(0,M.tZ)(x.Z,{title:(0,y.t)("Alerts"),orgSlug:s,children:(0,M.BX)(m.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,children:[(0,M.tZ)(q.Z,{organization:t,router:a,activeTab:"rules"}),this.renderList()]})})}}class ce extends i.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,a;const{location:s}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(a=s.query)||void 0===a?void 0:a.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,w.ec)({eventKey:"alert_rules.viewed",eventName:"Alert Rules: Viewed",organization_id:e.id,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,M.tZ)(de,{...this.props})}}ce.displayName="AlertRulesListContainer";const pe=(0,C.Z)(ce),ue=(0,n.Z)(c.uT,{target:"eddauwb5"})({name:"108qp7n",styles:"margin-bottom:-20px"}),me=(0,n.Z)(u.Z,{target:"eddauwb4"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),he=(0,n.Z)("div",{target:"eddauwb3"})("display:flex;margin-bottom:",(0,f.Z)(1.5),";"),ge=(0,n.Z)(Z.Z,{target:"eddauwb2"})("flex-grow:1;margin-left:",(0,f.Z)(1.5),";"),Ze=(0,n.Z)(g.KB,{target:"eddauwb1"})("overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){overflow:initial;}grid-template-columns:auto 1.5fr 1fr 1fr 1fr auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";"),xe=(0,n.Z)("p",{target:"eddauwb0"})("font-size:",(e=>e.theme.fontSizeLarge),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_index_tsx.cfe2e296b97ccb9938b8968b944d3791.js.map