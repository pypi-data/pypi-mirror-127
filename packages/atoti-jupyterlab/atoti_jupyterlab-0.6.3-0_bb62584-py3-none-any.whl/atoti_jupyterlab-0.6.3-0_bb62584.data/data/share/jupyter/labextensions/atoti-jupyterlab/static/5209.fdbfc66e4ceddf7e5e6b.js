(self.webpackChunkatoti_jupyterlab=self.webpackChunkatoti_jupyterlab||[]).push([[5209],{85209:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>V});var a=n(8336),o=n(56271),i=n(39349),l=n(39030),s=n(19805),r=n(3440),u=n.n(r),d=n(87622),c=n.n(d),y=n(9439),p=n.n(y),m=n(53347),x=n(66611),v=n(37946),g=n(80877),f=n(93897),h=n(71249),C=n(21469),b=n(31312);function E(e){return e.substring(5,e.length-1).split(",")}var k={name:"h3v94q-QueryContextEntryTileCaption",styles:"display:flex;;label:QueryContextEntryTileCaption;"},N={name:"1hmgl6r-QueryContextEntryTileCaption",styles:"flex-grow:1;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;;label:QueryContextEntryTileCaption;"},w={name:"whkwzk-QueryContextEntryTileCaption",styles:"text-align:right;flex-grow:1;flex-shrink:1;margin-left:10px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;min-width:35px;;label:QueryContextEntryTileCaption;"};const T=e=>{let t;const[n,i]=(0,o.useState)(null);if((0,o.useEffect)((()=>{"BOOL"!==e.type&&"ENUM"!==e.type&&i(e.value)}),[e.type,e.value]),"BOOL"===e.type)t=(0,a.jsx)(v.default,{checked:Boolean(e.value),disabled:e.isDisabled,onChange:()=>{var t;return null===(t=e.onValueChanged)||void 0===t?void 0:t.call(e,!e.value)}});else if(e.isDisabled)t=e.value;else if(e.type.startsWith("ENUM")){const n=E(e.type);t=(0,a.jsx)(f.Z,{value:e.value,size:"small",style:{width:80},onChange:e.onValueChanged,disabled:e.isDisabled},n.map((e=>(0,a.jsx)(f.Z.Option,{key:e,value:e},e))))}else t=(0,a.jsx)(g.Z,{style:{width:80},value:null!=n?n:"",onChange:e=>i(e.target.value),onBlur:t=>{const n=t.target.value;var a;isNaN(Number(n))&&"ALL"!==e.type||null===(a=e.onValueChanged)||void 0===a||a.call(e,n)},size:"small",disabled:e.isDisabled});return(0,a.jsx)("div",{css:k,key:e.name},(0,a.jsx)("div",{css:N},e.name),(0,a.jsx)("div",{css:w},t))};var j={name:"1etlk4r-QueryContextEntryEditionPopup",styles:"height:35px;display:flex;justify-content:flex-end;margin-top:8px;;label:QueryContextEntryEditionPopup;"},O={name:"hpxvrh-QueryContextEntryEditionPopup",styles:"&.ant-btn{margin-right:8px;};label:QueryContextEntryEditionPopup;"};const Q=e=>{var t;const{formatMessage:n}=(0,i.useIntl)(),{onOk:l,onCancel:s,templatedName:r}=e,[u,d]=(0,o.useState)(""),[c,y]=(0,o.useState)(""),p=(e=>{const t=e.indexOf("$"),n=e.lastIndexOf("$");return e.substring(t,n+1)})(r),m=r.replace(p,u);return(0,a.jsx)("div",{style:{width:400,display:"flex",flexDirection:"column"}},(0,a.jsx)("div",{style:{flexGrow:1}},(0,a.jsx)(g.Z,{style:{marginTop:8},placeholder:p,value:u,onChange:e=>d(e.target.value)}),(0,a.jsx)(g.Z,{style:{marginTop:8},placeholder:"value",value:c,onChange:e=>y(e.target.value)})),(0,a.jsx)("div",{css:j},(0,a.jsx)(C.default,{css:O,onClick:s},n({id:"aui.cancel"})),(0,a.jsx)(C.default,{onClick:()=>{l(m,c)},disabled:0===u.length||0===c.length||(null===(t=e.queryContext)||void 0===t?void 0:t.some((({key:e})=>e===m))),type:"primary"},n({id:"aui.ok"}))))},q=["drillthrough.hiddencolumns","subcube"],I=["mdx.kpi","mdx.member","mdx.formatters","mdx.set","mdx.measureAlias","mdx.defaultmembers","user-authentication"],K=["dashboard","page","widget"],R=(e,{sectionName:t,pageKey:n,leafKey:a})=>{const o="dashboard"===t?e:"page"===t?(0,b.fx)(e,n):(0,b.LI)(e,n,a);if(!o)throw new Error(`Impossible to edit the ${t}'s query context, as its corresponding state was not found.`);return o},S=(e,t,n)=>{e.queryContext||(e.queryContext=[]),e.queryContext.splice(n,0,t)},D=(e,t)=>{if(!e.queryContext)return;const{queryContext:n}=e;n.splice(t,1),0===n.length&&delete e.queryContext},V=(0,l.r3)((e=>{const{dashboardState:t,pageKey:n,leafKey:r,onDashboardChange:d}=(0,x.F)(e)?e:{},{dataModel:y,widgetState:v,onWidgetChange:g}=e,{formatMessage:f}=(0,i.useIntl)(),C=(0,l.cQ)(v,t,n),[b,k]=(0,o.useState)(null),N=(0,o.useMemo)((()=>c()(y.contextValues,"name")),[y.contextValues]),w=(0,o.useCallback)((e=>{if(N[e])return N[e].type;const t=p()(N,(({name:t})=>e.startsWith(t.replace(/\$.*\$$/,""))));return t?N[t].type:"ALL"}),[N]),j=(0,o.useMemo)((()=>{const e=y.contextValues.filter((({name:e})=>!q.some((t=>e.startsWith(t))))),t=u()(e,(({category:e})=>e||"misc"));return Object.keys(t).map((e=>({caption:e,isFolder:!0,isActionable:!1,type:e,children:t[e].map((t=>{const n={type:"QUERY_CONTEXT_ENTRY",key:t.name};return{caption:t.name,type:e,isActionable:!0,isDisabled:K.every((e=>{var n;return null===(n=C[e])||void 0===n?void 0:n.some((({key:e})=>e===t.name))})),dragItem:n}}))})))}),[y.contextValues,C]),O=(0,o.useMemo)((()=>{const o={};return o.default={caption:f({id:"aui.drawer.queryContextEditor.defaultSection"}),tiles:e.cube.contextValues.filter((({name:e})=>I.every((t=>!e.startsWith(t)))&&q.every((t=>!e.startsWith(t))))).map((({name:e,value:t},n)=>{const o={key:e,value:t,originSection:"default",originPosition:n,type:"QUERY_CONTEXT_ENTRY"};return{caption:(0,a.jsx)(T,{name:e,value:t,isDisabled:!0,type:w(e)}),dragItem:o,isEditable:!1,isDisabled:K.some((t=>{var n;return null===(n=C[t])||void 0===n?void 0:n.some((({key:t})=>t===e))})),isRemovable:!1}}))},K.forEach((e=>{const i=C[e];o[e]={caption:f({id:`aui.drawer.queryContextEditor.${e}Section`}),tiles:i?i.map((({key:o,value:i},l)=>{const s={key:o,value:i,originSection:e,originPosition:l,type:"QUERY_CONTEXT_ENTRY"},u=K.slice(K.indexOf(e)+1).some((e=>{var t;return null===(t=C[e])||void 0===t?void 0:t.some((e=>o===e.key))}));return{caption:(0,a.jsx)(T,{name:o,value:i,type:w(o),isDisabled:u,onValueChanged:a=>{if(d&&t&&n&&r){const o=(0,h.produce)(t,(t=>{R(t,{leafKey:r,pageKey:n,sectionName:e}).queryContext[l].value=a}));d(o)}else{const e=(0,h.produce)(v,(e=>{e.queryContext[l].value=a}));g(e)}}}),isEditable:!1,isRemovable:!0,isDisabled:u,dragItem:s}})):[]}})),b&&o[b.sectionName].tiles.splice(b.tileIndex,0,{caption:b.key,dragItem:null}),o}),[b,w,e.cube.contextValues,C,t,f,r,d,g,n,v]),V=(0,o.useCallback)(((e,a)=>{if(d&&t&&n&&r){const o=(0,h.produce)(t,(t=>{const o=R(t,{leafKey:r,pageKey:n,sectionName:e});D(o,a)}));d(o)}else{const e=(0,h.produce)(v,(e=>{D(e,a)}));g(e)}}),[t,r,d,n,v,g]),L=(0,o.useCallback)(((a,o,i)=>{var l;const s=null!=i?i:(null===(l=C[a])||void 0===l?void 0:l.length)||0;if(-1!==o.indexOf("$"))k({tileIndex:s,sectionName:a,key:o});else{const i={key:o,value:((e,t)=>{if(!e)return"";const n=t.find((({name:t})=>t===e.name));if(e.type.startsWith("ENUM"))return E(e.type)[0];switch(e.type){case"BOOL":return void 0===n||Boolean(n.value);case"LONG":case"INTEGER":case"DOUBLE":return void 0!==n?Number(n.value):0;case"RANGE":case"ALL":default:return(null==n?void 0:n.value)||""}})(N[o],e.cube.contextValues)};if(d&&t&&n&&r){const e=(0,h.produce)(t,(e=>{const t=R(e,{leafKey:r,pageKey:n,sectionName:a});S(t,i,s)}));d(e)}else{const e=(0,h.produce)(v,(e=>{S(e,i,s)}));g(e)}}}),[N,t,r,d,g,n,C,v,e.cube.contextValues]),_=(0,o.useCallback)((e=>{var t;e.isActionable&&!(null===(t=C.widget)||void 0===t?void 0:t.some((({key:t})=>t===e.caption)))&&L("widget",e.caption)}),[L,C]),A=(0,o.useCallback)(((e,a)=>{if(b){const o={key:e,value:a};if(d&&t&&n&&r){const e=(0,h.produce)(t,(e=>{const t=R(e,{leafKey:r,pageKey:n,sectionName:b.sectionName});S(t,o,b.tileIndex)}));d(e)}else{const e=(0,h.produce)(v,(e=>{S(e,o,b.tileIndex)}));g(e)}k(null)}}),[t,r,d,g,n,b,v]),M=(0,o.useCallback)(((e,a,o)=>{if(d&&t&&n&&r){const i=(0,h.produce)(t,(t=>{if("default"!==a.originSection){const e=R(t,{leafKey:r,pageKey:n,sectionName:a.originSection});D(e,a.originPosition)}const i=R(t,{leafKey:r,pageKey:n,sectionName:e});S(i,{key:a.key,value:a.value},o)}));d(i)}}),[t,r,d,n]),Y=(0,o.useCallback)(((e,t,n)=>{L(e,t.key,n)}),[L]);return(0,a.jsx)(l.A3,null,(0,a.jsx)(s.mp,{value:j,isSearchVisible:!0,searchPlaceholder:f({id:"aui.drawer.queryContextEditor.searchContextEntries"}),onClick:_}),(0,a.jsx)(m.e,{sections:O,dragItemTypes:["QUERY_CONTEXT_ENTRY"],canDrop:(e,t)=>{var n;return!("QUERY_CONTEXT_ENTRY"!==t.type||"default"===e||t.originSection&&t.originSection===e||(null===(n=C[e])||void 0===n?void 0:n.some((({key:e})=>e===t.key))))},placeholder:f({id:"aui.drawer.queryContextEditor.noQueryContextEntries"}),onTileRemoved:V,onTileMoved:M,onTileAdded:Y,popoverPosition:b,popover:b&&(0,a.jsx)(Q,{onOk:A,templatedName:b.key,onCancel:()=>k(null),queryContext:C[b.sectionName]}),popoverInnerHeight:110}))}))}}]);